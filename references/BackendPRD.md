## 1. Executive Summary

개인 투자자를 위한 **Human-in-the-Loop(HITL) 기반 멀티 에이전트 AI 투자 시스템**을 개발한다.

**핵심 가설**: 투자자는 귀찮은 정보 분석은 하기 싫어하지만, 종목 선택과 매매 실행은 직접 하고 싶어한다.

이 가설을 바탕으로, AI가 데이터 수집 및 분석을 자동화하되, 전략 수립과 매매 결정에서는 사용자가 원하는 만큼의 통제권을 행사할 수 있는 **선택 가능한 자동화 시스템**을 구축한다.

---

## 2. Product Vision & Goals

### 2.1 Vision

**"AI가 분석하고, 당신이 결정한다"**

투자자는 복잡한 데이터 분석에서 해방되면서도, 자신의 직관과 판단력을 발휘할 수 있는 투자 경험을 제공한다.

### 2.2 Core Value Proposition

**AI의 자동화 편리성 + 인간의 직관/통제욕구 동시 충족**

| AI의 역할            | 인간의 역할       |
| ----------------- | ------------ |
| 📊 데이터 수집 및 정제    | 🎯 최종 종목 선택  |
| 🔍 기업 분석 및 리스크 평가 | ✅ 매매 실행 승인   |
| 💡 전략 제안 및 시뮬레이션  | 🎨 포트폴리오 조정  |
| ⚠️ 리스크 경고 및 대안 제시 | 🧭 투자 방향성 설정 |

### 2.3 Product Goals

1. **사용자 통제감 보장**
    - 자동화 수준을 사용자가 선택하고 언제든 조정 가능
    - 중요한 의사결정은 반드시 사용자 개입
2. **분석 부담 제거**
    - AI가 수천 개 데이터 포인트를 자동 분석
    - 핵심 인사이트만 간결하게 제공
3. **점진적 학습 지원**
    - 사용자가 투자 경험을 쌓으면서 자연스럽게 자율성 증가
    - AI의 추론 근거를 통해 투자 학습 효과

---

## 3. Automation Level System

### 3.1 3단계 자동화 레벨

|레벨|모드명|설명|AI 자율성|사용자 개입 빈도|추천 대상|
|---|---|---|---|---|---|
|**1**|✈️ 파일럿 모드|AI가 거의 모든 것을 처리|85%|월 1회 확인|바쁜 직장인, 초보자|
|**2**|🤝 코파일럿 모드 ⭐|AI가 제안, 큰 결정만 승인|50%|주 1-2회 알림|배우고 싶은 초보자|
|**3**|📊 어드바이저 모드|AI는 정보만 제공, 사용자 결정|20%|일일 검토 가능|중급 이상 투자자|

⭐ **기본 추천**: 코파일럿 모드 (레벨 2)

### 3.2 레벨별 개입 지점 매트릭스

|프로세스 단계|파일럿 (Lv1)|코파일럿 (Lv2)|어드바이저 (Lv3)|
|---|---|---|---|
|데이터 수집|자동|자동|자동|
|데이터 분석|자동|자동|자동 (요청 시 상세)|
|전략 생성|자동 + 월 1회 리뷰|**승인 필요**|**사용자 주도**|
|포트폴리오 구성|자동 + 월 1회 리뷰|**승인 필요**|**사용자 주도**|
|매매 실행|자동 + 알림|**승인 필요**|**승인 필수**|
|리밸런싱|분기 1회 승인|**승인 필요**|**승인 필수**|
|모니터링|중요 이슈만 알림|주요 이슈 알림|상세 리포트 제공|

### 3.3 레벨 설정 및 변경

**초기 설정**

- 온보딩 과정의 '초기 스크리닝' 단계에서 설정
- 투자 경험, 시간 여유, 관여도 질문 기반 추천
- 사용자가 직접 레벨 선택 가능

**레벨 변경**

- 설정 메뉴에서 언제든 변경 가능
- 변경 시 영향 받는 부분 미리 고지
- 예: "코파일럿 → 파일럿 변경 시, 향후 포트폴리오 조정은 자동으로 진행되며 월 1회 리뷰만 제공됩니다."

**커스터마이징**

- 각 레벨 내에서 세부 개입 지점 조정 가능
- 예: 코파일럿 모드이지만 "매매 실행만 자동"으로 설정
- UI: 토글 스위치 형태로 각 단계별 설정

---

## 4. System Architecture

### 4.1 Multi-Agent Architecture

```
                    사용자 (Chat Interface)
                           ↕
                    마스터 에이전트
                    (Router + Orchestrator)
                           ↓
        ┌──────────────────┼──────────────────┐
        ↓                  ↓                  ↓
   리서치 에이전트     전략 에이전트      리스크 에이전트
        ↓                  ↓                  ↓
   교육/질의 에이전트  포트폴리오 에이전트  모니터링 에이전트

```

> 에이전트 아키텍쳐는 별도 문서 참조

## 5. User Flow

### 5.1 온보딩 프로세스

```
[회원가입/로그인]
        ↓
[초기 스크리닝]
  - 투자 목표 설정
  - 위험 성향 파악
  - 투자 기간 설정
  - 자동화 레벨 선택
        ↓
[전략 생성]
  - AI가 사용자 프로필 기반 전략 제안
  - 예: "중장기 성장형", "배당 중심 안정형"
        ↓
[포트폴리오 구성] ← HITL 개입
  - AI가 초안 생성
  - 자동화 레벨에 따라:
    * Lv1: 수용/거부
    * Lv2: 수용/보수적/공격적
    * Lv3: 상세 조정
        ↓
[매매 실행 승인] ← HITL 개입
  - 최종 거래 내역 확인
  - 자동화 레벨에 따라:
    * Lv1: 최종 확인만
    * Lv2: 승인 필요
    * Lv3: 개별 종목 승인
        ↓
[온보딩 완료]
  - 거래 내역 저장
  - 메인 대시보드로 이동
```

### 5.2 메인 프로세스 (Chat 인터페이스)

**일반적인 질의응답 플로우**

```
사용자 입력 (Chat)
        ↓
마스터 에이전트 (의도 분류)
        ↓
적절한 에이전트(들) 호출
        ↓
[필요시] HITL 개입 트리거
        ↓
결과 통합 및 응답 생성
        ↓
사용자에게 표시

```

**예시 1: 종목 평가 요청**

```
사용자: "삼성전자 지금 사도 될까?"
        ↓
마스터 → 리서치 에이전트 (기업 분석)
     → 전략 에이전트 (매매 타이밍 판단)
     → 리스크 에이전트 (리스크 평가)
        ↓
통합 결과:
"📊 삼성전자 분석 결과

 **기업 평가**: ⭐⭐⭐⭐ (4/5)
 - 최근 실적: 양호 (영업이익 전년비 +15%)
 - 기술적 지표: 단기 과매수 신호

 **매매 의견**: HOLD → BUY 전환 대기
 - 현재 가격: 76,000원 (목표가 대비 +3%)
 - 추천 매수가: 73,000원 이하

 **리스크**: 중간
 - 반도체 업황 불확실성

 💡 권장: 2주 후 실적 발표 후 재평가 추천"

```

**예시 2: 매매 지시 (HITL 발동)**

```
사용자: "삼성전자 1000만원어치 매수해줘"
        ↓
마스터 → 전략 에이전트 (주문 생성)
     → 리스크 에이전트 (리스크 체크)
        ↓
[리스크 경고 발생] ← 기존 삼성전자 보유 비중 높음
        ↓
HITL 개입 트리거 → 사용자 승인 요청
        ↓
"⚠️ 매매 실행 전 확인이 필요합니다

 **주문 내역**
 - 종목: 삼성전자
 - 금액: 10,000,000원
 - 예상 수량: 131주

 **리스크 경고**
 - 현재 삼성전자 보유: 25%
 - 매수 후 예상 비중: 43% ⚠️

 📊 과거 데이터:
 단일 종목 40% 이상 시 평균 수익률 -6.8%

 💡 권장 대안:
 1. 매수 금액을 500만원으로 조정 (비중 34%)
 2. 같은 섹터 SK하이닉스로 분산

 [취소] [금액 수정] [그대로 진행]"

```

**예시 3: 포트폴리오 리밸런싱 요청**

```
사용자: "포트폴리오 리밸런싱해줘"
        ↓
마스터 → 포트폴리오 에이전트 (분석 + 제안)
        ↓
현재 vs 목표 비교 → 리밸런싱안 생성
        ↓
HITL 개입 (자동화 레벨에 따라)
        ↓
[레벨 2 - 코파일럿 모드 예시]
"📊 리밸런싱 제안

 **현재 포트폴리오**
 - 삼성전자: 35% (목표 30%)
 - SK하이닉스: 15% (목표 20%)
 - NAVER: 10% (목표 15%)
 - 현금: 40%

 **제안 거래**
 - 삼성전자 매도: 200만원
 - SK하이닉스 매수: 150만원
 - NAVER 매수: 150만원

 **예상 효과**
 - 리스크 감소: 18.5% → 16.2%
 - 예상 수익률: 유지

 [수용] [보수적으로] [공격적으로] [취소]"

```

**예시 4: AI 자체 판단 요청 (후순위)**

```
[시스템 내부 프로세스]

전략 에이전트:
  Bull 서브: "삼성전자 상승 예상" (신뢰도 53%)
  Bear 서브: "삼성전자 하락 예상" (신뢰도 47%)
        ↓
[의견 차이 < 10%p 감지]
        ↓
마스터 에이전트 → HITL 트리거
        ↓
"🤔 AI 판단이 명확하지 않습니다

 **삼성전자 전망**

 📈 상승 의견 (53%)
 - 근거: 반도체 업황 개선 조짐
 - 근거: 기술적으로 지지선 확인
 - 신뢰도: ★★★☆☆

 📉 하락 의견 (47%)
 - 근거: 글로벌 경기 둔화 우려
 - 근거: 단기 과매수 신호
 - 신뢰도: ★★★☆☆

 💭 당신의 판단이 필요합니다
 [상승에 베팅] [중립 유지] [하락에 대비]"

```

---

## 6. MVP Feature Requirements

### 6.1 Phase 1 - MVP (핵심 기능)

|기능|우선순위|HITL|복잡도|구현 기간|
|---|---|---|---|---|
|**Chat 인터페이스**|P0|-|Low|1주|
|**마스터 에이전트 (Router)**|P0|-|Medium|2주|
|**자동화 레벨 설정 UI**|P0|Yes|Low|1주|
|**종목 검색 및 기본 정보**|P0|No|Low|1주|
|**기업 재무 분석 (DART)**|P0|No|Medium|2주|
|**뉴스/공시 모니터링**|P0|No|Medium|2주|
|**종목 매수/매도 추천**|P0|Yes|High|3주|
|**포트폴리오 구성 제안**|P0|Yes|High|3주|
|**리스크 평가 및 경고**|P0|Yes|Medium|2주|
|**HITL 승인 인터페이스**|P0|Yes|Medium|2주|
|**한국투자증권 API 연동**|P0|-|Medium|1주|
|**DART API 연동**|P0|-|Low|1주|
|**AI 권고안 제시 시스템**|P1|Yes|Medium|2주|
|**모니터링 에이전트 (명시적)**|P1|No|Medium|2주|

### 6.2 Phase 2 - 확장 (추가 기능)

|기능|우선순위|HITL|복잡도|비고|
|---|---|---|---|---|
|**사용자 계정 시스템**|P0|-|Medium|필수|
|**투자 성향 진단**|P0|No|Low|초기 스크리닝|
|**포트폴리오 추적 및 히스토리**|P0|No|Medium|-|
|**리밸런싱 자동 제안**|P1|Yes|High|-|
|**모니터링 에이전트 (트리거)**|P1|No|High|알림 시스템|
|**백테스팅 시뮬레이션**|P1|No|High|-|
|**Bull/Bear 토론 시각화**|P1|-|Medium|고급 기능|
|**사용자 행동 학습**|P2|-|High|개인화|
|**자동화 레벨 커스터마이징**|P1|Yes|Medium|세부 설정|
|실시간 Push 알림|P2|No|Medium|-|

### 6.3 Phase 3 - 미래 (확장 계획)

|기능|우선순위|복잡도|비고|
|---|---|---|---|
|**해외 주식 지원**|P1|Very High|미국, 일본 우선|
|**실제 매매 실행**|P2|Very High|증권사 API 연동|
|**모바일 앱**|P1|High|iOS/Android|
|**음성 인터페이스**|P2|Medium|음성 명령|
|**소셜 기능**|P2|Medium|커뮤니티|

---

## 7. Technical Requirements

### 7.1 데이터 소스

|소스|제공 정보|연동 방법|
|---|---|---|
|한국투자증권 API|실시간 시세, 차트, 호가|REST API|
|DART|공시 문서, 재무제표|REST API|
|뉴스 크롤링|네이버 금융, 증권 뉴스|Web Scraping|

### 7.2 실시간 정보 제공 방법

**별도 문서 참조**: "실시간 정보 제공 방법 비교 (MCP vs Alternatives)"

### 7.3 Tech Stack (간략)

|구성 요소|기술|
|---|---|
|AI Framework|LangChain / LangGraph|
|LLM|GPT-4o, Claude Sonnet|
|Backend|FastAPI (Python)|
|Frontend|Next.js (React)|
|Database|PostgreSQL|
|Vector DB|Pinecone (DART RAG)|
|Message Queue|Redis|

---

## 8. Success Metrics

### 8.1 MVP 성공 지표

|지표|목표|
|---|---|
|핵심 기능 완성도|100%|
|시스템 안정성|Uptime 95%+|
|평균 응답 속도|< 3초|
|베타 테스트 완료|5명+|
|사용자 만족도|긍정 80%+|

### 8.2 Phase 2+ 지표

|지표|목표|
|---|---|
|AI 추천 수용률|> 60%|
|일간 활성 사용자|70%+|
|재방문율|주 3회+|
|HITL 개입 만족도|> 75%|

---

## 9. Constraints & Assumptions

### 9.1 제약사항

- **MVP 범위**: 실제 매매 실행 없음 (시뮬레이션만)
- **시장**: 한국 주식만 지원
- **사용자 계정**: Phase 2에서 구현
- **실시간성**: 5분 지연 허용

### 9.2 가정 (추후 페르소나 분석을 통해 구체화)

- 사용자는 한국투자증권 계좌 보유
- 사용자는 기본적인 투자 용어 이해
- 데이터 API 사용 제한 없음
- Chat 인터페이스에 익숙함

---

## 10. Risk Analysis

|리스크|영향도|완화 방안|
|---|---|---|
|API 사용 제한|High|캐싱, Rate limiting|
|AI 응답 품질|High|Prompt engineering, Evaluation|
|복잡한 HITL 로직|Medium|단계적 구현, 충분한 테스트|
|사용자 이탈|Medium|온보딩 최적화, 튜토리얼|

---

## 11. Out of Scope

**MVP에서 제외**

- ❌ 실제 매매 실행 (Phase 2)
- ❌ 사용자 계정/인증 (Phase 2)
- ❌ 해외 주식 (Phase 3)
- ❌ 모바일 앱 (Phase 3)
- ❌ 소셜 기능 (Phase 3)
- ❌ AI 추론 과정 완전 공개 (구현 복잡도 및 사용자 혼란 우려)
- ❌ 실시간 Push 알림 (Phase 2)
- ❌ 고급 개인화 (행동 학습 등은 Phase 2)
- ❌ 백테스팅 (Phase 2)

**명확한 제외 사항**

- ❌ 컴플라이언스 자동화 (Phase 2)
- ❌ AI의 모든 추론 과정 공개: 기술적으로 복잡하고 사용자에게 오히려 혼란을 줄 수 있음. 대신 Bull/Bear 분석 등 핵심 의사결정 근거만 제공
- ~~❌ 완전 자동 매매: 사용자 승인 없는 자동 거래는 법적/윤리적 이슈 존재~~

---

## 12. Next Steps

1. ✅ PRD 검토 및 승인
2. ✅ 유저 플로우 상세 설계
3. ⏭️ 데이터 스키마 설계
4. ⏭️ API 명세 작성
5. ⏭️ UI/UX 와이어프레임
6. ⏭️ 개발 착수

---

**문서 끝**