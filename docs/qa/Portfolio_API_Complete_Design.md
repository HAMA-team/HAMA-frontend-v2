# Portfolio API ì™„ì „ ìƒì„¸ ì„¤ê³„ ë¬¸ì„œ

**ì‘ì„±ì¼**: 2025-10-30
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-30 (ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ)
**ì‘ì„±ì**: Claude Code
**ëª©ì **: OpenAPI ìŠ¤í™ ê¸°ì¤€ Portfolio API ì™„ì „ ë¶„ì„ + UI ì„¤ê³„ + í•„ìš”ì„± íŒë‹¨ + ë°ì´í„° íƒ€ì… + ëŒ€ì•ˆ ì œì‹œ
**í…ŒìŠ¤íŠ¸ í™˜ê²½**: `http://localhost:8000` (2025-10-30 03:04 KST)

---

## ğŸ“‹ ëª©ì°¨

1. [API ê°œìš” ë° ìš°ì„ ìˆœìœ„](#api-ê°œìš”-ë°-ìš°ì„ ìˆœìœ„)
2. [ì—”ë“œí¬ì¸íŠ¸ #1: GET /api/v1/portfolio/](#ì—”ë“œí¬ì¸íŠ¸-1-get-apiv1portfolio)
3. [ì—”ë“œí¬ì¸íŠ¸ #2: GET /api/v1/portfolio/chart-data](#ì—”ë“œí¬ì¸íŠ¸-2-get-apiv1portfoliochart-data)
4. [ì—”ë“œí¬ì¸íŠ¸ #3: GET /api/v1/portfolio/{portfolio_id}](#ì—”ë“œí¬ì¸íŠ¸-3-get-apiv1portfolioportfolio_id)
5. [ì—”ë“œí¬ì¸íŠ¸ #4: GET /api/v1/portfolio/{portfolio_id}/performance](#ì—”ë“œí¬ì¸íŠ¸-4-get-apiv1portfolioportfolio_idperformance)
6. [ì—”ë“œí¬ì¸íŠ¸ #5: POST /api/v1/portfolio/{portfolio_id}/rebalance](#ì—”ë“œí¬ì¸íŠ¸-5-post-apiv1portfolioportfolio_idrebalance)
7. [UI í†µí•© ì„¤ê³„ì•ˆ](#ui-í†µí•©-ì„¤ê³„ì•ˆ)
8. [ë°±ì—”ë“œ ê°œì„  ê¶Œì¥ì‚¬í•­](#ë°±ì—”ë“œ-ê°œì„ -ê¶Œì¥ì‚¬í•­)
9. [í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ê³„íš](#í”„ë¡ íŠ¸ì—”ë“œ-ì‘ì—…-ê³„íš)

---

## API ê°œìš” ë° ìš°ì„ ìˆœìœ„

### ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| Priority | Endpoint | Method | í˜„ì¬ ìƒíƒœ | Phase | ë¹„ê³  |
|----------|----------|--------|----------|-------|------|
| **P0** (í•„ìˆ˜) | `/api/v1/portfolio/` | GET | âœ… ì™„ë£Œ | Phase 1 | í˜„ì¬ í”„ë¡ íŠ¸ ì‚¬ìš© ì¤‘ |
| **P2** (ë‚˜ì¤‘) | `/api/v1/portfolio/chart-data` | GET | âš ï¸ ë¬¸ì œ | Phase 3 | OpenAPI: query param í•„ìˆ˜, ì‹¤ì œ: ì„ íƒ |
| **P1** (ì¤‘ìš”) | `/api/v1/portfolio/{portfolio_id}/performance` | GET | âŒ ë¯¸êµ¬í˜„ | Phase 2 | ì„±ê³¼ ì§€í‘œ UI í•„ìš” |
| **P3** (ì„ íƒ) | `/api/v1/portfolio/{portfolio_id}` | GET | âŒ ë¯¸ì‚¬ìš© | Phase 4 | ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ ì‹œ í•„ìš” |
| **P3** (ì„ íƒ) | `/api/v1/portfolio/{portfolio_id}/rebalance` | POST | âŒ ë¯¸ì‚¬ìš© | Phase 4 | HITL í†µí•© í•„ìš” |

### ìš°ì„ ìˆœìœ„ ê¸°ì¤€

- **P0 (Critical)**: í˜„ì¬ ì‚¬ìš© ì¤‘, ì¦‰ì‹œ ìˆ˜ì • í•„ìš”
- **P1 (High)**: ì‹œì—° í•„ìˆ˜, Phase 2 ë‚´ ì™„ë£Œ
- **P2 (Medium)**: ê¸°ëŠ¥ì€ ì¢‹ì§€ë§Œ ëŒ€ì•ˆ ê°€ëŠ¥
- **P3 (Low)**: ì¶”í›„ ê¸°ëŠ¥, í˜„ì¬ ë¶ˆí•„ìš”

---

## ì—”ë“œí¬ì¸íŠ¸ #1: GET /api/v1/portfolio/

### ğŸ“Œ ê¸°ë³¸ ì •ë³´

**ëª©ì **: í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´ ê°œìš” (ìš”ì•½ + ë³´ìœ  ì¢…ëª© + ë°°ë¶„)
**Priority**: **P0** (í˜„ì¬ ì‚¬ìš© ì¤‘)
**OpenAPI Operation ID**: `get_portfolio_overview_api_v1_portfolio__get`

### ğŸ“Š ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (OpenAPI ê¸°ì¤€)

#### PortfolioOverview

```typescript
interface PortfolioOverview {
  summary: PortfolioSummarySection;
  holdings: PortfolioHoldingItem[];
  allocation: PortfolioAllocation;
}
```

### âœ… ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2025-10-30)

**ìš”ì²­**:
```bash
curl http://localhost:8000/api/v1/portfolio/
```

**ì‘ë‹µ**: 200 OK âœ…

**ì‹¤ì œ ë°ì´í„°**:
```json
{
  "summary": {
    "total_value": 10000000.0,
    "principal": 8100000.0,
    "profit": 1900000.0,
    "profit_rate": 23.456790123456788,
    "cash": 1900000.0,
    "cash_percentage": 19.0,
    "updated_at": "2025-10-29T17:47:42.915072"
  },
  "holdings": [
    {
      "stock_code": "005930",
      "stock_name": "ì‚¼ì„±ì „ì",
      "quantity": 50,
      "avg_price": 60000.0,
      "current_price": 72000.0,
      "market_value": 3600000.0,
      "profit": 600000.0,
      "profit_rate": 20.0,
      "weight": 36.0
    },
    {
      "stock_code": "000660",
      "stock_name": "SKí•˜ì´ë‹‰ìŠ¤",
      "quantity": 20,
      "avg_price": 95000.0,
      "current_price": 120000.0,
      "market_value": 2400000.0,
      "profit": 500000.0,
      "profit_rate": 26.31578947368421,
      "weight": 24.0
    },
    {
      "stock_code": "005380",
      "stock_name": "í˜„ëŒ€ì°¨",
      "quantity": 10,
      "avg_price": 200000.0,
      "current_price": 210000.0,
      "market_value": 2100000.0,
      "profit": 100000.0,
      "profit_rate": 5.0,
      "weight": 21.0
    }
  ],
  "allocation": {
    "sectors": [
      {
        "name": "ë°˜ë„ì²´",
        "value": 6000000.0,
        "percentage": 60.0
      },
      {
        "name": "ìë™ì°¨",
        "value": 2100000.0,
        "percentage": 21.0
      },
      {
        "name": "í˜„ê¸ˆ",
        "value": 1900000.0,
        "percentage": 19.0
      }
    ],
    "asset_classes": [
      {
        "name": "ì£¼ì‹",
        "value": 8100000.0,
        "percentage": 81.0
      },
      {
        "name": "í˜„ê¸ˆ",
        "value": 1900000.0,
        "percentage": 19.0
      }
    ]
  }
}
```

**ê²€ì¦ ê²°ê³¼**:
- âœ… ìŠ¤í‚¤ë§ˆ ì¼ì¹˜
- âœ… ì„¹í„° ì •ë³´ ì œê³µë¨ (ë°˜ë„ì²´, ìë™ì°¨, í˜„ê¸ˆ)
- âœ… ëª¨ë“  í•„ë“œ íƒ€ì… ì •í™•

#### PortfolioSummarySection

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `total_value` | `number` | âœ… | ì´ í‰ê°€ê¸ˆì•¡ (ì›) | `10000000.0` |
| `principal` | `number` | âœ… | íˆ¬ìì›ê¸ˆ (ì›) | `8100000.0` |
| `profit` | `number` | âœ… | ìˆ˜ìµê¸ˆ (ì›) | `1900000.0` |
| `profit_rate` | `number` | âœ… | ìˆ˜ìµë¥  (%) | `23.46` |
| `cash` | `number` | âœ… | í˜„ê¸ˆ ë³´ìœ ì•¡ (ì›) | `1900000.0` |
| `cash_percentage` | `number` | âœ… | í˜„ê¸ˆ ë¹„ì¤‘ (%) | `19.0` |
| `updated_at` | `string \| null` | âŒ | ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ (ISO 8601) | `"2025-10-28T11:54:08.503805"` |

#### PortfolioHoldingItem

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `stock_code` | `string` | âœ… | ì¢…ëª©ì½”ë“œ | `"005930"` |
| `stock_name` | `string` | âœ… | ì¢…ëª©ëª… | `"ì‚¼ì„±ì „ì"` |
| `quantity` | `integer` | âœ… | ë³´ìœ  ìˆ˜ëŸ‰ | `50` |
| `avg_price` | `number` | âœ… | í‰ê·  ë§¤ìˆ˜ê°€ (ì›) | `60000.0` |
| `current_price` | `number` | âœ… | í˜„ì¬ê°€ (ì›) | `72000.0` |
| `market_value` | `number` | âœ… | í‰ê°€ê¸ˆì•¡ (ì›) | `3600000.0` |
| `profit` | `number` | âœ… | ìˆ˜ìµê¸ˆ (ì›) | `600000.0` |
| `profit_rate` | `number` | âœ… | ìˆ˜ìµë¥  (%) | `20.0` |
| `weight` | `number` | âœ… | ë¹„ì¤‘ (%) | `36.0` |

**âš ï¸ ì£¼ì˜**: `weight`ëŠ” **ë°±ë¶„ìœ¨** (36.0 = 36%)

#### PortfolioAllocation

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| `sectors` | `AllocationItem[]` | âœ… | ì„¹í„°ë³„ ë°°ë¶„ |
| `asset_classes` | `AllocationItem[]` | âœ… | ìì‚° í´ë˜ìŠ¤ë³„ ë°°ë¶„ (ì£¼ì‹/í˜„ê¸ˆ) |

#### AllocationItem

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `name` | `string` | âœ… | ì´ë¦„ (ì„¹í„°ëª… ë˜ëŠ” ìì‚° í´ë˜ìŠ¤) | `"ë°˜ë„ì²´"`, `"ì£¼ì‹"` |
| `value` | `number` | âœ… | ê¸ˆì•¡ (ì›) | `4500000.0` |
| `percentage` | `number` | âœ… | ë¹„ì¤‘ (%) | `45.0` |

### ğŸ¨ í˜„ì¬ UI êµ¬í˜„ (`/portfolio` í˜ì´ì§€)

#### 1. ìš”ì•½ ì¹´ë“œ (PortfolioSummary.tsx)

**ìœ„ì¹˜**: í˜ì´ì§€ ìƒë‹¨, 4ê°œ ì¹´ë“œ ê°€ë¡œ ë°°ì¹˜ (ë°˜ì‘í˜• ê·¸ë¦¬ë“œ)

| ì¹´ë“œ | ë°ì´í„° ì†ŒìŠ¤ | í‘œì‹œ í˜•ì‹ | ìƒ‰ìƒ |
|------|-------------|-----------|------|
| **ì´ í‰ê°€ê¸ˆì•¡** | `summary.total_value` | `â‚©10,000,000` | `--text-primary` |
| **ì´ ìˆ˜ìµë¥ ** | `summary.profit_rate` + `summary.profit` | `+23.46%`<br/>`â‚©1,900,000` | Profit: `--chart-profit`<br/>Loss: `--chart-loss` |
| **ë³´ìœ  ì¢…ëª© ìˆ˜** | `holdings.length` | `3ì¢…ëª©` | `--text-primary` |
| **í˜„ê¸ˆ ë³´ìœ ì•¡** | `summary.cash` | `â‚©1,900,000` | `--text-primary` |

**ì•„ì´ì½˜**:
- ì´ í‰ê°€ê¸ˆì•¡: `DollarSign`
- ì´ ìˆ˜ìµë¥ : `TrendingUp` (í”ŒëŸ¬ìŠ¤) / `TrendingDown` (ë§ˆì´ë„ˆìŠ¤)
- ë³´ìœ  ì¢…ëª© ìˆ˜: `Briefcase`
- í˜„ê¸ˆ ë³´ìœ ì•¡: `Wallet`

**ìŠ¤íƒ€ì¼**:
- ì¹´ë“œ: `rounded-xl`, `p-5`, `border`, `bg-container-background`
- ì œëª©: `text-sm`, `color: --text-secondary`
- ê¸ˆì•¡: `text-[28px]`, `font-bold`, `tracking-tight`

#### 2. ì°¨íŠ¸ (Treemap/Pie/Bar)

**ë°ì´í„° ì†ŒìŠ¤**: `holdings` ë°°ì—´ ì§ì ‘ ì‚¬ìš©

**Treemap** (PortfolioTreemap.tsx):
- ì¢…ëª©ë³„ í‰ê°€ê¸ˆì•¡ì„ ë©´ì ìœ¼ë¡œ í‘œì‹œ
- ìƒ‰ìƒ: `useChartColors()` í›…ì—ì„œ ìˆœì„œëŒ€ë¡œ í• ë‹¹
- ë¼ë²¨: ì¢…ëª©ëª…, ë¹„ì¤‘(%), ìˆ˜ìµë¥ (%)
- íˆ´íŒ: í‰ê°€ê¸ˆì•¡, ë¹„ì¤‘, ìˆ˜ìµë¥ 

**Pie Chart** (PortfolioPieChart.tsx):
- ì¢…ëª©ë³„ ë¹„ì¤‘ì„ ì›í˜•ìœ¼ë¡œ í‘œì‹œ
- ìƒ‰ìƒ: `useChartColors()` ë™ì¼
- ë²”ë¡€: í•˜ë‹¨

**Bar Chart** (PortfolioBarChart.tsx):
- ì¢…ëª©ë³„ ìˆ˜ìµë¥ ì„ ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ í‘œì‹œ
- ìƒ‰ìƒ: ìˆ˜ìµë¥  ê¸°ë°˜ (ì–‘ìˆ˜/ìŒìˆ˜)

### âŒ í˜„ì¬ ë¬¸ì œì 

1. **ì„¹í„° ì •ë³´ ë¯¸ì‚¬ìš©**
   - ë°±ì—”ë“œ: `allocation.sectors` ì œê³µ
   - í”„ë¡ íŠ¸: ë¬´ì‹œí•˜ê³  `sector: ""` í•˜ë“œì½”ë”©
   - **ì˜í–¥**: Pie Chartê°€ "ì„¹í„°ë³„ ë¹„ì¤‘" ëŒ€ì‹  "ì¢…ëª©ë³„ ë¹„ì¤‘" í‘œì‹œ

2. **asset_classes ë¯¸ì‚¬ìš©**
   - ë°±ì—”ë“œ: `allocation.asset_classes` (ì£¼ì‹/í˜„ê¸ˆ êµ¬ë¶„)
   - í”„ë¡ íŠ¸: ë¯¸ì‚¬ìš©
   - **ì˜í–¥**: í˜„ê¸ˆ ë¹„ì¤‘ì„ ì°¨íŠ¸ì— í‘œì‹œ ì•ˆ í•¨

3. **updated_at ë¯¸í‘œì‹œ**
   - ë°±ì—”ë“œ: ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê° ì œê³µ
   - í”„ë¡ íŠ¸: í‘œì‹œ ì•ˆ í•¨
   - **ì˜í–¥**: ë°ì´í„° ì‹ ì„ ë„ ë¶ˆëª…í™•

### âœ… UI ê°œì„  ì œì•ˆ

#### ì œì•ˆ A: ì„¹í„° ì •ë³´ í™œìš© (ì¶”ì²œ)

**ë³€ê²½ ìœ„ì¹˜**: `portfolio.ts:mapOverviewToPortfolio()`

```typescript
// í˜„ì¬
sector: "", // not provided by API

// ê°œì„ ì•ˆ: allocation.sectorsì—ì„œ ì—­ìœ¼ë¡œ ë§¤í•‘
const sectorMap = buildSectorMap(api.allocation.sectors);
sector: sectorMap[h.stock_code] || "ê¸°íƒ€"
```

**ì¶”ê°€ ì»´í¬ë„ŒíŠ¸**: Pie Chartì— **"ì„¹í„°ë³„ ë¹„ì¤‘"** ì˜µì…˜ ì¶”ê°€

```typescript
<ChartTypeSelector
  selectedType={chartType}
  selectedGroupBy={groupBy}  // ìƒˆë¡œ ì¶”ê°€: "stock" | "sector"
  onTypeChange={...}
  onGroupByChange={...}
/>
```

**êµ¬í˜„**:
- Pie Chart: `groupBy === "sector"` ì¼ ë•Œ `allocation.sectors` ì‚¬ìš©
- Treemap: ì„¹í„°ë³„ ê·¸ë£¹í™” + ê³„ì¸µ êµ¬ì¡°

#### ì œì•ˆ B: í˜„ê¸ˆ í¬í•¨ ì°¨íŠ¸

**ë³€ê²½ ìœ„ì¹˜**: ëª¨ë“  ì°¨íŠ¸ ì»´í¬ë„ŒíŠ¸

**ë°©ë²•**:
1. `allocation.asset_classes`ì—ì„œ í˜„ê¸ˆ ë¹„ì¤‘ ì¶”ì¶œ
2. ì°¨íŠ¸ ë°ì´í„°ì— í˜„ê¸ˆ í•­ëª© ì¶”ê°€ (`{ name: "í˜„ê¸ˆ", value: ..., ...}`)
3. ìƒ‰ìƒ: `--text-secondary` (íšŒìƒ‰ ê³„ì—´)

#### ì œì•ˆ C: ë°ì´í„° ì‹ ì„ ë„ í‘œì‹œ

**ë³€ê²½ ìœ„ì¹˜**: í˜ì´ì§€ ìƒë‹¨ ë˜ëŠ” ìš”ì•½ ì¹´ë“œ í•˜ë‹¨

```tsx
{summary.updated_at && (
  <p className="text-xs text-secondary mt-2">
    ìµœê·¼ ì—…ë°ì´íŠ¸: {formatRelativeOrDate(summary.updated_at, 1)}
  </p>
)}
```

### ğŸ”§ ë°±ì—”ë“œ ìˆ˜ì • í•„ìš”ì‚¬í•­

**ì—†ìŒ** - ì´ë¯¸ ëª¨ë“  ë°ì´í„° ì œê³µ ì¤‘

### ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… í•­ëª©

1. âœ… **í˜„ì¬ ì™„ë£Œ**: ê¸°ë³¸ UI, ì°¨íŠ¸ 3ì¢…
2. ğŸ”² **Phase 2**: ì„¹í„° ì •ë³´ í™œìš©, í˜„ê¸ˆ í¬í•¨ ì°¨íŠ¸
3. ğŸ”² **Phase 2**: ë°ì´í„° ì‹ ì„ ë„ í‘œì‹œ
4. ğŸ”² **Phase 3**: Pie Chart ì„¹í„° ê·¸ë£¹í™” ì˜µì…˜

---

## ì—”ë“œí¬ì¸íŠ¸ #2: GET /api/v1/portfolio/chart-data

### ğŸ“Œ ê¸°ë³¸ ì •ë³´

**ëª©ì **: Rechartsìš© ìµœì í™” ë°ì´í„° (Treemap, Pie)
**Priority**: **P2** (ê¸°ëŠ¥ ì¢‹ì§€ë§Œ ì¤‘ë³µ)
**OpenAPI Operation ID**: `get_portfolio_chart_data_api_v1_portfolio_chart_data_get`

### âš ï¸ **ì¤‘ëŒ€í•œ ë¬¸ì œì **

#### 1. OpenAPI vs ì‹¤ì œ êµ¬í˜„ ë¶ˆì¼ì¹˜

**OpenAPI ìŠ¤í™**:
```yaml
parameters:
  - name: portfolio_id
    in: query
    required: true  # âš ï¸ í•„ìˆ˜
```

**ì‹¤ì œ ë°±ì—”ë“œ ì½”ë“œ** (`portfolio.py`):
- Line 379-487: `portfolio_id` íŒŒë¼ë¯¸í„° ì—†ìŒ
- Line 539-710: `portfolio_id` íŒŒë¼ë¯¸í„° ìˆìŒ (optionalë¡œ ì¶”ì •)

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**: `portfolio_id` ì—†ì´ë„ 200 OK ë°˜í™˜

#### 2. ì¤‘ë³µ í•¸ë“¤ëŸ¬

**ë™ì¼ ê²½ë¡œ**ì— **2ê°œ í•¸ë“¤ëŸ¬** ì •ì˜:
1. `@router.get("/chart-data")` (line 379)
2. `@router.get("/chart-data")` (line 539)

**FastAPI ë™ì‘**: ë‚˜ì¤‘ ì •ì˜(line 539)ê°€ ìš°ì„ 

### ğŸ“Š ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (OpenAPI ê¸°ì¤€)

#### PortfolioChartData (OpenAPI ì •ì˜)

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `stocks` | `StockChartData[]` | âœ… | ì¢…ëª© ëª©ë¡ | ì•„ë˜ ì°¸ì¡° |
| `total_value` | `number` (â‰¥0) | âœ… | ì´ í‰ê°€ê¸ˆì•¡ (ì›) | `10000000` |
| `total_return` | `number` | âœ… | ì´ ìˆ˜ìµê¸ˆ (ì›) | `900000` |
| `total_return_percent` | `number` | âœ… | ì´ ìˆ˜ìµë¥  (%) | `9.0` |
| `cash` | `number` (â‰¥0) | âœ… | í˜„ê¸ˆ (ì›) | `1000000` |
| `sectors` | `Record<string, number>` | âœ… | ì„¹í„°ë³„ ë¹„ì¤‘ (0~1) | `{"ë°˜ë„ì²´": 0.45}` |

### âš ï¸ **ì‹¤ì œ ì‘ë‹µì€ OpenAPIì™€ ë‹¤ë¦„!**

#### ì‹¤ì œ ì‘ë‹µ êµ¬ì¡° (í…ŒìŠ¤íŠ¸ í™•ì¸)

```typescript
interface ActualChartDataResponse {
  portfolio_id: string;           // â† OpenAPIì— ì—†ìŒ
  total_value: string;            // â† numberê°€ ì•„ë‹ˆë¼ string!
  cash_balance: string;           // â† "cash"ê°€ ì•„ë‹ˆë¼ "cash_balance"
  invested_amount: string;        // â† OpenAPIì— ì—†ìŒ
  total_return: string;           // â† string (Decimal)
  positions: Position[];          // â† "stocks"ê°€ ì•„ë‹ˆë¼ "positions"
  risk_profile: string;           // â† OpenAPIì— ì—†ìŒ
  last_updated: string;           // â† OpenAPIì— ì—†ìŒ
}

interface Position {
  stock_code: string;
  stock_name: string;
  quantity: number;
  average_price: string;          // â† Decimal string
  current_price: string;          // â† Decimal string
  market_value: string;           // â† Decimal string
  unrealized_pnl: null;           // â† í•­ìƒ null
  unrealized_pnl_rate: null;      // â† í•­ìƒ null
  weight: string;                 // â† ë¹„ìœ¨ (0.36), Decimal string
  sector: string;                 // â† ì„¹í„° ì •ë³´ ìˆìŒ!
}
```

### âœ… ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2025-01-26)

**ìš”ì²­**:
```bash
curl http://localhost:8000/api/v1/portfolio/chart-data
```

**ì‘ë‹µ**: 200 OK âœ…

**ì‹¤ì œ ë°ì´í„°**:
```json
{
  "portfolio_id": "portfolio_mock_fallback",
  "total_value": "10000000.0",
  "cash_balance": "1900000.0",
  "invested_amount": "8100000.0",
  "total_return": "0.2345679012345679012345679012",
  "positions": [
    {
      "stock_code": "005930",
      "stock_name": "ì‚¼ì„±ì „ì",
      "quantity": 50,
      "average_price": "60000.0",
      "current_price": "72000.0",
      "market_value": "3600000.0",
      "unrealized_pnl": null,
      "unrealized_pnl_rate": null,
      "weight": "0.36",
      "sector": "ë°˜ë„ì²´"
    },
    {
      "stock_code": "000660",
      "stock_name": "SKí•˜ì´ë‹‰ìŠ¤",
      "quantity": 20,
      "average_price": "95000.0",
      "current_price": "120000.0",
      "market_value": "2400000.0",
      "unrealized_pnl": null,
      "unrealized_pnl_rate": null,
      "weight": "0.24",
      "sector": "ë°˜ë„ì²´"
    },
    {
      "stock_code": "005380",
      "stock_name": "í˜„ëŒ€ì°¨",
      "quantity": 10,
      "average_price": "200000.0",
      "current_price": "210000.0",
      "market_value": "2100000.0",
      "unrealized_pnl": null,
      "unrealized_pnl_rate": null,
      "weight": "0.21",
      "sector": "ìë™ì°¨"
    },
    {
      "stock_code": "CASH",
      "stock_name": "í˜„ê¸ˆ",
      "quantity": 0,
      "average_price": "1.0",
      "current_price": "1.0",
      "market_value": "1900000.0",
      "unrealized_pnl": null,
      "unrealized_pnl_rate": null,
      "weight": "0.19",
      "sector": "í˜„ê¸ˆ"
    }
  ],
  "risk_profile": "moderate",
  "last_updated": "2025-10-29T17:47:48.121874"
}
```

**ê²€ì¦ ê²°ê³¼**:
- âŒ **OpenAPI ìŠ¤í‚¤ë§ˆì™€ ì™„ì „íˆ ë‹¤ë¦„**
- âœ… ì„¹í„° ì •ë³´ ê° positionì— í¬í•¨
- âš ï¸ **í˜„ê¸ˆì´ CASH positionìœ¼ë¡œ í¬í•¨ë¨** (í”„ë¡ íŠ¸ì—ì„œ í•„í„°ë§ í•„ìš”)
- âš ï¸ ëª¨ë“  ê¸ˆì•¡ í•„ë“œê°€ **string** (Decimal ì§ë ¬í™”)

#### StockChartData

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `stock_code` | `string` | âœ… | ì¢…ëª©ì½”ë“œ | `"005930"` |
| `stock_name` | `string` | âœ… | ì¢…ëª©ëª… | `"ì‚¼ì„±ì „ì"` |
| `quantity` | `integer` (â‰¥0) | âœ… | ìˆ˜ëŸ‰ | `10` |
| `current_price` | `number` (â‰¥0) | âœ… | í˜„ì¬ê°€ (ì›) | `76300` |
| `purchase_price` | `number` (â‰¥0) | âœ… | ë§¤ìˆ˜ê°€ (ì›) | `70000` |
| `weight` | `number` (0~1) | âœ… | ë¹„ì¤‘ | `0.35` |
| `return_percent` | `number` | âœ… | ìˆ˜ìµë¥  (%) | `9.0` |
| `sector` | `string` | âœ… | ì„¹í„° | `"ë°˜ë„ì²´"` |

**âš ï¸ ì£¼ì˜**: `weight`ëŠ” **ë¹„ìœ¨** (0.35 = 35%), `/portfolio/`ëŠ” ë°±ë¶„ìœ¨(35.0)

### ğŸ†š /portfolio/ vs /chart-data ë¹„êµ

| í•­ëª© | `/portfolio/` | `/chart-data` |
|------|---------------|---------------|
| **weight í˜•ì‹** | ë°±ë¶„ìœ¨ (36.0) | ë¹„ìœ¨ (0.36) |
| **ì„¹í„° ì •ë³´** | `allocation.sectors` (array) | `sectors` (object, key=ì„¹í„°ëª…) |
| **ìƒ‰ìƒ ì •ë³´** | âŒ ì—†ìŒ | âœ… ìˆìŒ (`color` í•„ë“œ) - ë‹¨, ì‹¤ì œ êµ¬í˜„ í•¸ë“¤ëŸ¬ì—ë§Œ |
| **ì¶”ê°€ ì •ë³´** | `allocation.asset_classes` | `cash_weight` |
| **ìš©ë„** | ì „ì²´ ê°œìš” | ì°¨íŠ¸ ì „ìš© |

### ğŸ¨ í˜„ì¬ UI ì‚¬ìš© í˜„í™©

**ì‚¬ìš©ì²˜**: `APICheckPanel.tsx` (Healthcheckë§Œ)

```typescript
const checkPortfolioChart = async () => {
  const data = await fetchPortfolioChartData();
  // ì‹¤ì œ ì‚¬ìš© ì•ˆ í•¨, 200 OKë§Œ í™•ì¸
};
```

**ì‹¤ì œ ì°¨íŠ¸**: `/portfolio/` ì‘ë‹µ ì‚¬ìš© (`holdings` ë°°ì—´)

### â“ ì´ APIê°€ í•„ìš”í•œê°€?

#### í•„ìš”í•˜ë‹¤ë©´:

**ì¥ì **:
1. **ì°¨íŠ¸ ìµœì í™” ë°ì´í„°**: ìƒ‰ìƒ ì •ë³´ í¬í•¨, ë¹„ìœ¨ í˜•ì‹
2. **ì„¹í„° ì •ë³´ ë‹¨ìˆœí™”**: Object í˜•íƒœë¡œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
3. **í™•ì¥ì„±**: ì°¨íŠ¸ ì „ìš© í•„ë“œ ì¶”ê°€ ìš©ì´

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- Treemap: `stocks` ë°°ì—´ ì§ì ‘ ì‚¬ìš©, `color` í•„ë“œë¡œ ìˆ˜ìµë¥  ì‹œê°í™”
- Pie Chart (ì„¹í„°ë³„): `sectors` Object ì§ì ‘ ì‚¬ìš©

#### í•„ìš” ì—†ë‹¤ë©´:

**ì´ìœ **:
1. `/portfolio/`ë¡œ ëª¨ë“  ì •ë³´ ì œê³µ ê°€ëŠ¥
2. í”„ë¡ íŠ¸ì—ì„œ ë³€í™˜ ë¡œì§ ì¶”ê°€í•˜ë©´ ë¨ (ë¹„ìœ¨â†”ë°±ë¶„ìœ¨)
3. ì¤‘ë³µ ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´

**ëŒ€ì•ˆ**:
- `/portfolio/` ì‘ë‹µì— `chartData` í•„ë“œ ì¶”ê°€
- ë˜ëŠ” í”„ë¡ íŠ¸ì—ì„œ ë³€í™˜ í•¨ìˆ˜ ì‘ì„±

### âœ… ê¶Œì¥ì‚¬í•­

#### ì˜µì…˜ A: í†µí•© (ì¶”ì²œ)

**ë°©ë²•**: `/portfolio/` ì‘ë‹µì— ì°¨íŠ¸ ë°ì´í„° í¬í•¨

```typescript
interface PortfolioOverview {
  summary: PortfolioSummarySection;
  holdings: PortfolioHoldingItem[];
  allocation: PortfolioAllocation;
  chartData: PortfolioChartData;  // ì¶”ê°€
}
```

**ì¥ì **:
- ë‹¨ì¼ API í˜¸ì¶œë¡œ ëª¨ë“  ì •ë³´
- ì¤‘ë³µ í•¸ë“¤ëŸ¬ ì œê±°
- ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

#### ì˜µì…˜ B: ë¶„ë¦¬ ìœ ì§€ + ì •ë¦¬

**ë°©ë²•**:
1. ë°±ì—”ë“œì—ì„œ ì¤‘ë³µ í•¸ë“¤ëŸ¬ ì œê±° (line 379-487 ì‚­ì œ)
2. OpenAPI `required: false`ë¡œ ìˆ˜ì •
3. í”„ë¡ íŠ¸ì—ì„œ ì‹¤ì œ ì‚¬ìš© (í˜„ì¬ëŠ” Healthcheckë§Œ)

**ì¥ì **:
- ì°¨íŠ¸ ì „ìš© ìµœì í™” ìœ ì§€
- í•„ìš” ì‹œì—ë§Œ í˜¸ì¶œ (ì„±ëŠ¥)

**ë‹¨ì **:
- 2ë²ˆì˜ API í˜¸ì¶œ í•„ìš”
- ë°ì´í„° ë™ê¸°í™” ì´ìŠˆ ê°€ëŠ¥

#### ì˜µì…˜ C: ì‚­ì œ

**ë°©ë²•**: API ì™„ì „ ì œê±°, í”„ë¡ íŠ¸ì—ì„œ ë³€í™˜ ë¡œì§ êµ¬í˜„

**ì¥ì **:
- ë°±ì—”ë“œ ë‹¨ìˆœí™”
- í”„ë¡ íŠ¸ ì œì–´ê¶Œ ì¦ê°€

**ë‹¨ì **:
- í”„ë¡ íŠ¸ ë³µì¡ë„ ì¦ê°€
- ìƒ‰ìƒ ì •ë³´ ë“± ë°±ì—”ë“œ ë¡œì§ ì†ì‹¤

### ğŸ”§ ë°±ì—”ë“œ ìˆ˜ì • í•„ìš”ì‚¬í•­

1. **ì¦‰ì‹œ ìˆ˜ì •**: ì¤‘ë³µ í•¸ë“¤ëŸ¬ ì œê±°
2. **Phase 2**: ì˜µì…˜ A/B/C ì¤‘ ì„ íƒí•˜ì—¬ ë¦¬íŒ©í† ë§

### ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… í•­ëª©

1. ğŸ”² **Phase 2**: ë°±ì—”ë“œ ìˆ˜ì • í›„ ì˜ì‚¬ê²°ì •ì— ë”°ë¼ ì¬êµ¬í˜„

---

## ì—”ë“œí¬ì¸íŠ¸ #3: GET /api/v1/portfolio/{portfolio_id}

### ğŸ“Œ ê¸°ë³¸ ì •ë³´

**ëª©ì **: íŠ¹ì • í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ì¡°íšŒ
**Priority**: **P3** (ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ ì‹œ í•„ìš”)
**OpenAPI Operation ID**: `get_portfolio_api_v1_portfolio__portfolio_id__get`

### ğŸ“Š ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (OpenAPI ê¸°ì¤€)

#### PortfolioSummary

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `portfolio_id` | `string` | âœ… | í¬íŠ¸í´ë¦¬ì˜¤ ID | `"portfolio_001"` |
| `total_value` | `string` | âœ… | ì´ í‰ê°€ê¸ˆì•¡ (Decimal) | `"10000000.0"` |
| `cash_balance` | `string` | âœ… | í˜„ê¸ˆ (Decimal) | `"1900000.0"` |
| `invested_amount` | `string` | âœ… | íˆ¬ìì›ê¸ˆ (Decimal) | `"8100000.0"` |
| `total_return` | `string` | âœ… | ìˆ˜ìµë¥  ë¹„ìœ¨ (Decimal) | `"0.2345679..."` |
| `positions` | `Position[]` | âœ… | ë³´ìœ  ì¢…ëª© | ì•„ë˜ ì°¸ì¡° |
| `risk_profile` | `string \| null` | âŒ | ë¦¬ìŠ¤í¬ í”„ë¡œí•„ | `"moderate"` |
| `last_updated` | `string \| null` | âŒ | ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ | `"2025-10-28..."` |

#### Position

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| `stock_code` | `string` | âœ… | ì¢…ëª©ì½”ë“œ | `"005930"` |
| `stock_name` | `string` | âœ… | ì¢…ëª©ëª… | `"ì‚¼ì„±ì „ì"` |
| `quantity` | `integer \| null` | âŒ | ìˆ˜ëŸ‰ | `50` |
| `average_price` | `string \| null` | âŒ | í‰ê·  ë§¤ìˆ˜ê°€ (Decimal) | `"60000.0"` |
| `current_price` | `string \| null` | âŒ | í˜„ì¬ê°€ (Decimal) | `"72000.0"` |
| `market_value` | `string \| null` | âŒ | í‰ê°€ê¸ˆì•¡ (Decimal) | `"3600000.0"` |
| `unrealized_pnl` | `string \| null` | âŒ | ë¯¸ì‹¤í˜„ ì†ìµ (Decimal) | `"600000.0"` |
| `unrealized_pnl_rate` | `string \| null` | âŒ | ë¯¸ì‹¤í˜„ ì†ìµë¥  (Decimal) | `"0.20"` |
| `weight` | `string \| null` | âŒ | ë¹„ì¤‘ (Decimal) | `"0.36"` |
| `sector` | `string \| null` | âŒ | ì„¹í„° | `"ë°˜ë„ì²´"` |

**âš ï¸ íƒ€ì… ì£¼ì˜**:
- ê¸ˆì•¡/ë¹„ìœ¨ í•„ë“œê°€ ëª¨ë‘ **string** (Decimal ì§ë ¬í™”)
- `/portfolio/`ëŠ” **number**
- í”„ë¡ íŠ¸ì—ì„œ íŒŒì‹± í•„ìš”

### ğŸ†š /portfolio/ vs /{portfolio_id} ë¹„êµ

| í•­ëª© | `/portfolio/` | `/{portfolio_id}` |
|------|---------------|-------------------|
| **ìš©ë„** | ì „ì²´ ê°œìš” | íŠ¹ì • í¬íŠ¸í´ë¦¬ì˜¤ |
| **íƒ€ì…** | `number` | `string` (Decimal) |
| **êµ¬ì¡°** | `holdings` (flat) | `positions` (nullable í•„ë“œ ë§ìŒ) |
| **ì¶”ê°€ ì •ë³´** | `allocation` | `risk_profile` |
| **í˜„ì¬ ì‚¬ìš©** | âœ… | âŒ |

### â“ ì´ APIê°€ í•„ìš”í•œê°€?

#### í•„ìš”í•˜ë‹¤ë©´:

**ì‹œë‚˜ë¦¬ì˜¤**: ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ ì§€ì›

**ì˜ˆì‹œ**:
```
/portfolio                    # ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ëª©ë¡
/portfolio/main               # ë©”ì¸ í¬íŠ¸í´ë¦¬ì˜¤
/portfolio/retirement         # ì€í‡´ í¬íŠ¸í´ë¦¬ì˜¤
/portfolio/kids_education     # ìë…€ êµìœ¡ í¬íŠ¸í´ë¦¬ì˜¤
```

**UI ì„¤ê³„**:
- LNBì— í¬íŠ¸í´ë¦¬ì˜¤ ì„ íƒ ë“œë¡­ë‹¤ìš´
- `/portfolio/{id}` í˜ì´ì§€ë¡œ ë¼ìš°íŒ…
- ê° í¬íŠ¸í´ë¦¬ì˜¤ë³„ ì°¨íŠ¸/í†µê³„

#### í•„ìš” ì—†ë‹¤ë©´:

**ì´ìœ **:
1. **Phase 1-3**: ë‹¨ì¼ í¬íŠ¸í´ë¦¬ì˜¤ë§Œ ì§€ì›
2. `/portfolio/`ë¡œ ì¶©ë¶„
3. ì¤‘ë³µ ë¡œì§ ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´

**ëŒ€ì•ˆ**:
- Phase 4ì— ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ì¬ê²€í† 
- í˜„ì¬ëŠ” ì‚­ì œ or ë¬¸ì„œì—ì„œë§Œ ìœ ì§€

### âœ… ê¶Œì¥ì‚¬í•­

#### ì˜µì…˜ A: Phase 4ë¡œ ì—°ê¸° (ì¶”ì²œ)

**ë°©ë²•**:
1. ë°±ì—”ë“œ ì½”ë“œ ìœ ì§€ (ë¯¸ë˜ ëŒ€ë¹„)
2. í”„ë¡ íŠ¸ ì—°ë™ ì•ˆ í•¨
3. OpenAPI ë¬¸ì„œì— "Phase 4 ê¸°ëŠ¥" ëª…ì‹œ

#### ì˜µì…˜ B: ì‚­ì œ

**ë°©ë²•**:
- ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ ì œê±°
- OpenAPI ìŠ¤í™ ì œê±°
- Phase 4 í•„ìš” ì‹œ ì¬êµ¬í˜„

#### ì˜µì…˜ C: í˜„ì¬ í†µí•©

**ë°©ë²•**:
- `/portfolio/`ê°€ ë‚´ë¶€ì ìœ¼ë¡œ `/{portfolio_id}` í˜¸ì¶œ
- `portfolio_id = "default"` í•˜ë“œì½”ë”©
- ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ ì¤€ë¹„

### ğŸ”§ ë°±ì—”ë“œ ìˆ˜ì • í•„ìš”ì‚¬í•­

**Phase 4ê¹Œì§€**: ì—†ìŒ (í˜„ì¬ ìƒíƒœ ìœ ì§€)

### ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… í•­ëª©

**Phase 4**: ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ UI ì„¤ê³„ í›„ ì—°ë™

---

## ì—”ë“œí¬ì¸íŠ¸ #4: GET /api/v1/portfolio/{portfolio_id}/performance

### ğŸ“Œ ê¸°ë³¸ ì •ë³´

**ëª©ì **: í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼ ì§€í‘œ (Sharpe, VaR, Volatility ë“±)
**Priority**: **P1** (ì‹œì—° ì‹œ ì¢‹ì€ ì„íŒ©íŠ¸)
**OpenAPI Operation ID**: `get_portfolio_performance_api_v1_portfolio__portfolio_id__performance_get`

### ğŸ“Š ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (OpenAPI ê¸°ì¤€)

**âš ï¸ OpenAPIì— ìŠ¤í‚¤ë§ˆ ì •ì˜ ì—†ìŒ** - ë°±ì—”ë“œ ì½”ë“œ ë¶„ì„ í•„ìš”

#### ë°±ì—”ë“œ ì½”ë“œ ë¶„ì„ (`portfolio.py:364-376`)

```python
response = {
    "portfolio_id": str,
    "total_return": float,           # ì´ ìˆ˜ìµë¥  (0.23 = 23%)
    "annual_return": float | None,   # ì—°í™˜ì‚° ìˆ˜ìµë¥ 
    "sharpe_ratio": float | None,    # ìƒ¤í”„ ë¹„ìœ¨
    "max_drawdown": float | None,    # ìµœëŒ€ ë‚™í­ (MDD)
    "volatility": float | None,      # ë³€ë™ì„± (í‘œì¤€í¸ì°¨)
    "var_95": float | None,          # 95% VaR (Value at Risk)
    "beta": float | None,            # ë² íƒ€ (ì‹œì¥ ë¯¼ê°ë„)
    "observations": int | None       # ê´€ì¸¡ ë°ì´í„° ìˆ˜
}
```

### âœ… ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2025-01-26)

**ìš”ì²­**:
```bash
curl http://localhost:8000/api/v1/portfolio/default/performance
```

**ì‘ë‹µ**: 200 OK âœ…

**ì‹¤ì œ ë°ì´í„°**:
```json
{
  "portfolio_id": "portfolio_mock_fallback",
  "total_return": 0.2345679012345679,
  "annual_return": null,
  "sharpe_ratio": null,
  "max_drawdown": 0.18,
  "volatility": 0.08,
  "var_95": 0.132,
  "beta": {
    "005930": 1.1,
    "000660": 1.3,
    "005380": 0.9
  },
  "observations": null
}
```

**âš ï¸ ì¤‘ìš”í•œ ë°œê²¬**:
1. **Betaê°€ Object!**
   - ì˜ˆìƒ: `beta: float | null` (í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´)
   - ì‹¤ì œ: `beta: Record<string, float>` (ì¢…ëª©ë³„ ë² íƒ€)
   - **í”„ë¡ íŠ¸ì—ì„œ í¬íŠ¸í´ë¦¬ì˜¤ ë² íƒ€ ê³„ì‚° í•„ìš”**: ê°€ì¤‘í‰ê· 

2. **nullì¸ í•„ë“œ**:
   - `annual_return`: null (ê³„ì‚° ì•ˆ ë¨)
   - `sharpe_ratio`: null (ê³„ì‚° ì•ˆ ë¨)
   - `observations`: null (ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜ ì—†ìŒ)

3. **ì‚¬ìš© ê°€ëŠ¥í•œ ì§€í‘œ**:
   - âœ… `total_return`: 0.234... (23.46%)
   - âœ… `max_drawdown`: 0.18 (18%)
   - âœ… `volatility`: 0.08 (8%)
   - âœ… `var_95`: 0.132 (13.2%)
   - âœ… `beta`: ì¢…ëª©ë³„ ì œê³µ (í¬íŠ¸í´ë¦¬ì˜¤ ë² íƒ€ëŠ” ê³„ì‚° í•„ìš”)

### ğŸ“ˆ ì§€í‘œ ì„¤ëª…

| ì§€í‘œ | ì˜ë¯¸ | ì¢‹ì€ ê°’ | ë‚˜ìœ ê°’ | UI í‘œì‹œ ë°©ë²• |
|------|------|---------|---------|--------------|
| **Total Return** | ì´ ìˆ˜ìµë¥  | ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ | ë‚®ê±°ë‚˜ ìŒìˆ˜ | ë°±ë¶„ìœ¨, ìƒ‰ìƒ (Â±) |
| **Annual Return** | ì—°í™˜ì‚° ìˆ˜ìµë¥  | ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ | ë‚®ìŒ | ë°±ë¶„ìœ¨ |
| **Sharpe Ratio** | ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ | >1.0 ìš°ìˆ˜ | <0 ë‚˜ì¨ | ìˆ«ì (2.3), ì„¤ëª… íˆ´íŒ |
| **Max Drawdown** | ìµœëŒ€ ë‚™í­ | ì ˆëŒ€ê°’ ì‘ì„ìˆ˜ë¡ | í° ìŒìˆ˜ | ë°±ë¶„ìœ¨ (-15%), ë¹¨ê°„ìƒ‰ |
| **Volatility** | ë³€ë™ì„± | ë‚®ì„ìˆ˜ë¡ ì•ˆì • | ë†’ìŒ | ë°±ë¶„ìœ¨ (12%), ê²Œì´ì§€ |
| **VaR 95%** | 95% ì‹ ë¢°êµ¬ê°„ ì†ì‹¤ | ì‘ì„ìˆ˜ë¡ ì¢‹ìŒ | í¼ | ê¸ˆì•¡ (â‚©-50ë§Œ) |
| **Beta** | ì‹œì¥ ë¯¼ê°ë„ | ~1.0 ì´ìƒì  | ë§¤ìš° ë†’ê±°ë‚˜ ë‚®ìŒ | ìˆ«ì (1.2) âš ï¸ ì¢…ëª©ë³„ ì œê³µ, ê°€ì¤‘í‰ê·  í•„ìš” |
| **Observations** | ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜ | ë§ì„ìˆ˜ë¡ ì‹ ë¢° | ì ìŒ | ì‘ì€ ê¸€ì”¨ |

### ğŸ¨ UI ì„¤ê³„ì•ˆ

#### ìœ„ì¹˜ ì œì•ˆ

**ì˜µì…˜ A**: `/portfolio` í˜ì´ì§€ í•˜ë‹¨ì— ì„¹ì…˜ ì¶”ê°€

```
[ìš”ì•½ ì¹´ë“œ 4ê°œ]
[ì°¨íŠ¸ íƒ€ì… ì„ íƒ]
[ì°¨íŠ¸]
[ì„±ê³¼ ì§€í‘œ â†  ìƒˆë¡œ ì¶”ê°€]
```

**ì˜µì…˜ B**: ë³„ë„ íƒ­

```
/portfolio       â†’ ê°œìš” (í˜„ì¬)
/portfolio/performance â†’ ì„±ê³¼ ì§€í‘œ (ìƒˆë¡œ ì¶”ê°€)
```

**ì¶”ì²œ**: **ì˜µì…˜ A** (ë‹¨ì¼ í˜ì´ì§€ì— ëª¨ë“  ì •ë³´)

#### UI ì»´í¬ë„ŒíŠ¸ ì„¤ê³„ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)

**PortfolioPerformance.tsx**

```tsx
<div className="mt-8">
  <h2 className="text-xl font-bold mb-4">ì„±ê³¼ ì§€í‘œ</h2>

  {/* í•µì‹¬ ì§€í‘œ 3ê°œ */}
  <div className="grid grid-cols-3 gap-4 mb-6">
    <MetricCard
      title="ì´ ìˆ˜ìµë¥ "
      value={formatPercent(performance.total_return)}
      trend={performance.total_return >= 0 ? "up" : "down"}
      tooltip="í˜„ì¬ê¹Œì§€ ëˆ„ì  ìˆ˜ìµë¥ "
    />
    {/* annual_return, sharpe_ratioëŠ” nullì´ë¯€ë¡œ ìƒëµ ë˜ëŠ” Coming Soon í‘œì‹œ */}
    <MetricCard
      title="ìµœëŒ€ ë‚™í­ (MDD)"
      value={formatPercent(performance.max_drawdown)}
      color="error"
      tooltip="ìµœê³ ì  ëŒ€ë¹„ ìµœëŒ€ í•˜ë½í­"
    />
    <MetricCard
      title="ë³€ë™ì„±"
      value={formatPercent(performance.volatility)}
      tooltip="ê°€ê²© ë³€ë™ì˜ í‘œì¤€í¸ì°¨"
    />
  </div>

  {/* ì¶”ê°€ ì§€í‘œ */}
  <div className="grid grid-cols-2 gap-4">
    <DetailMetric
      label="VaR (95%)"
      value={formatPercent(performance.var_95)}
      tooltip="95% ì‹ ë¢°êµ¬ê°„ ìµœëŒ€ ì†ì‹¤"
    />
    <DetailMetric
      label="í¬íŠ¸í´ë¦¬ì˜¤ Beta"
      value={calculatePortfolioBeta(performance.beta, holdings).toFixed(2)}
      tooltip="ì‹œì¥ ëŒ€ë¹„ ë¯¼ê°ë„ (ê°€ì¤‘í‰ê· )"
    />
  </div>

  {/* Beta ê³„ì‚° í•¨ìˆ˜ */}
  {/*
  function calculatePortfolioBeta(
    betas: Record<string, number>,
    holdings: { stock_code: string, weight: number }[]
  ): number {
    return holdings.reduce((sum, h) => {
      const beta = betas[h.stock_code] ?? 1.0;
      return sum + (beta * h.weight / 100);
    }, 0);
  }
  */}
</div>
```

**âš ï¸ Phase 2 êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­**:
1. `annual_return`, `sharpe_ratio`ëŠ” null â†’ "ì¤€ë¹„ ì¤‘" ë˜ëŠ” ìƒëµ
2. BetaëŠ” ì¢…ëª©ë³„ â†’ ê°€ì¤‘í‰ê· ìœ¼ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ ë² íƒ€ ê³„ì‚° í•„ìš”
3. `observations`ë„ null â†’ ì‹ ë¢°ë„ í‘œì‹œ ë¶ˆê°€

#### ìƒ¤í”„ ë¹„ìœ¨ ë“±ê¸‰

```typescript
function getSharpeRating(sharpe: number | null): string {
  if (sharpe === null) return "N/A";
  if (sharpe > 2.0) return "Excellent";  // ì´ˆë¡ ë°°ì§€
  if (sharpe > 1.0) return "Good";       // íŒŒë‘ ë°°ì§€
  if (sharpe > 0.5) return "Fair";       // ë…¸ë‘ ë°°ì§€
  return "Poor";                          // ë¹¨ê°• ë°°ì§€
}
```

### â“ ì´ APIê°€ í•„ìš”í•œê°€?

#### í•„ìš”í•˜ë‹¤:

**ì´ìœ **:
1. **ì „ë¬¸ì„± ê³¼ì‹œ**: ê¸ˆìœµ í”Œë«í¼ë‹¤ìš´ ê³ ê¸‰ ì§€í‘œ
2. **ì‹œì—° íš¨ê³¼**: ìº¡ìŠ¤í†¤ ë°œí‘œ ì‹œ ì„íŒ©íŠ¸ í¼
3. **íˆ¬ì íŒë‹¨ ì§€ì›**: ë‹¨ìˆœ ìˆ˜ìµë¥  ì´ìƒì˜ ì •ë³´

**ì‚¬ìš©ì ê°€ì¹˜**:
- Sharpe Ratio â†’ ë¦¬ìŠ¤í¬ ëŒ€ë¹„ íš¨ìœ¨ ì´í•´
- MDD â†’ ì‹¬ë¦¬ì  ê°ë‚´ ê°€ëŠ¥ ì†ì‹¤ íŒë‹¨
- Beta â†’ ì‹œì¥ ëŒ€ë¹„ ë³€ë™ì„± íŒŒì•…

#### ì£¼ì˜ì‚¬í•­:

**ë°ì´í„° ì¶œì²˜ ë¶ˆëª…**:
- ë°±ì—”ë“œ: `market_data.get("sharpe_ratio")` ë“± ì¡°íšŒ
- **ì–´ë””ì„œ ê³„ì‚°?** â†’ `portfolio_service` ë˜ëŠ” ë³„ë„ ëª¨ë“ˆ?
- **ì‹¤ì‹œê°„ vs ì¼ê°„ ë°°ì¹˜?**

**UI ë³µì¡ë„**:
- ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ Sharpe/VaRëŠ” ìƒì†Œ
- íˆ´íŒ/ë„ì›€ë§ í•„ìˆ˜
- "ê°„ë‹¨íˆ ë³´ê¸°" / "ìì„¸íˆ ë³´ê¸°" í† ê¸€ ê³ ë ¤

### âœ… ê¶Œì¥ì‚¬í•­

#### Phase 2 êµ¬í˜„ (ì¶”ì²œ)

**ë°©ë²•**:
1. ë°±ì—”ë“œ íŒ€ê³¼ ì§€í‘œ ê³„ì‚° ë¡œì§ í™•ì¸
2. UI ì„¤ê³„ ê²€í†  (ê°„ë‹¨í•œ ë²„ì „ë¶€í„°)
3. íˆ´íŒ/ë„ì›€ë§ ì‘ì„± (í•œ/ì˜)
4. Phase 2 ì¤‘ë°˜ì— êµ¬í˜„

**ìµœì†Œ ë²„ì „** (Phase 2-A):
- ì—°í™˜ì‚° ìˆ˜ìµë¥ 
- ìƒ¤í”„ ë¹„ìœ¨
- ìµœëŒ€ ë‚™í­

**ì „ì²´ ë²„ì „** (Phase 2-B):
- ìœ„ 3ê°œ + Volatility, VaR, Beta

### ğŸ”§ ë°±ì—”ë“œ ìˆ˜ì • í•„ìš”ì‚¬í•­

1. **OpenAPI ìŠ¤í‚¤ë§ˆ ì¶”ê°€** (í˜„ì¬ ëˆ„ë½)
2. **Beta íƒ€ì… ìˆ˜ì •**:
   - í˜„ì¬: `beta: float | None` (ì˜ëª»ë¨)
   - ì‹¤ì œ: `beta: Record<string, float>` (ì¢…ëª©ë³„)
   - ë˜ëŠ” í¬íŠ¸í´ë¦¬ì˜¤ ì „ì²´ ë² íƒ€ ì¶”ê°€ ê³„ì‚°
3. **nullì¸ í•„ë“œ ê³„ì‚° êµ¬í˜„**:
   - `annual_return`: ì¼ê°„ ìˆ˜ìµë¥  * 252
   - `sharpe_ratio`: (ìˆ˜ìµë¥  - ë¬´ìœ„í—˜ì´ììœ¨) / ë³€ë™ì„±
   - `observations`: ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜
4. **ì§€í‘œ ê³„ì‚° ë¡œì§ ë¬¸ì„œí™”**

### ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… í•­ëª©

1. ğŸ”² **Phase 2-A**: ë°±ì—”ë“œ í™•ì¸ + UI ì„¤ê³„ í™•ì •
2. ğŸ”² **Phase 2-B**: `PortfolioPerformance.tsx` êµ¬í˜„
3. ğŸ”² **Phase 2-B**: íˆ´íŒ/ë„ì›€ë§ ì‘ì„±
4. ğŸ”² **Phase 2-C**: i18n ë²ˆì—­

---

## ì—”ë“œí¬ì¸íŠ¸ #5: POST /api/v1/portfolio/{portfolio_id}/rebalance

### ğŸ“Œ ê¸°ë³¸ ì •ë³´

**ëª©ì **: í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ìƒì„±
**Priority**: **P3** (HITL í†µí•© í•„ìš”, Phase 4)
**OpenAPI Operation ID**: `rebalance_portfolio_api_v1_portfolio__portfolio_id__rebalance_post`

### ğŸ“Š ì‘ë‹µ ìŠ¤í‚¤ë§ˆ (OpenAPI ê¸°ì¤€)

**âš ï¸ OpenAPIì— ìŠ¤í‚¤ë§ˆ ì •ì˜ ì—†ìŒ** - ë°±ì—”ë“œ ì½”ë“œ ë¶„ì„ í•„ìš”

#### ë°±ì—”ë“œ ì½”ë“œ ë¶„ì„ (`portfolio.py:526-536`)

```python
response = {
    "portfolio_id": str,
    "rebalancing_needed": bool,      # ë¦¬ë°¸ëŸ°ì‹± í•„ìš” ì—¬ë¶€
    "requires_approval": bool,       # HITL ìŠ¹ì¸ í•„ìš” ì—¬ë¶€
    "expected_return": float | None, # ì˜ˆìƒ ìˆ˜ìµë¥ 
    "expected_volatility": float | None,  # ì˜ˆìƒ ë³€ë™ì„±
    "sharpe_ratio": float | None,    # ì˜ˆìƒ ìƒ¤í”„ ë¹„ìœ¨
    "proposed_allocation": dict,     # ëª©í‘œ ë°°ë¶„ (ì¢…ëª©ì½”ë“œ: ë¹„ì¤‘)
    "trades": list,                  # ë§¤ë§¤ ì§€ì‹œ ëª©ë¡
    "message": str                   # ì„¤ëª… ë©”ì‹œì§€
}
```

### ğŸ¨ UI ì„¤ê³„ì•ˆ

#### í”Œë¡œìš°

```
[í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€]
  â†“
[ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ë°›ê¸° ë²„íŠ¼ í´ë¦­]
  â†“
[POST /rebalance í˜¸ì¶œ]
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ if requires_approval:       â”‚
â”‚   â†’ HITL íŒ¨ë„ ì˜¤í”ˆ          â”‚
â”‚ else:                       â”‚
â”‚   â†’ ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### HITL íŒ¨ë„ ë‚´ìš©

**ì œëª©**: "ë¦¬ë°¸ëŸ°ì‹± ìŠ¹ì¸ ìš”ì²­"

**ì„¹ì…˜ 1**: í˜„ì¬ vs ëª©í‘œ ë¹„ì¤‘

| ì¢…ëª© | í˜„ì¬ ë¹„ì¤‘ | ëª©í‘œ ë¹„ì¤‘ | ë³€í™” |
|------|-----------|-----------|------|
| ì‚¼ì„±ì „ì | 36% | 30% | -6% â†“ |
| SKí•˜ì´ë‹‰ìŠ¤ | 24% | 25% | +1% â†‘ |
| í˜„ëŒ€ì°¨ | 21% | 20% | -1% â†“ |
| í˜„ê¸ˆ | 19% | 25% | +6% â†‘ |

**ì„¹ì…˜ 2**: ì˜ˆìƒ íš¨ê³¼

- ì˜ˆìƒ ìˆ˜ìµë¥ : **12.5%** (+2.1%p â†‘)
- ì˜ˆìƒ ë³€ë™ì„±: **15.3%** (-1.2%p â†“)
- ìƒ¤í”„ ë¹„ìœ¨: **1.85** (+0.3 â†‘)

**ì„¹ì…˜ 3**: ë§¤ë§¤ ì§€ì‹œ

```
[ë§¤ë„] ì‚¼ì„±ì „ì 5ì£¼ @ â‚©72,000 = â‚©360,000
[ë§¤ìˆ˜] SKí•˜ì´ë‹‰ìŠ¤ 1ì£¼ @ â‚©120,000 = â‚©120,000
```

**ì„¹ì…˜ 4**: ì•¡ì…˜ ë²„íŠ¼

- [ìŠ¹ì¸] â†’ `/chat/approve` API í˜¸ì¶œ
- [ê±°ë¶€] â†’ ì·¨ì†Œ
- [ìˆ˜ì •] â†’ ë¹„ì¤‘ ì¡°ì • UI (Phase 5)

### â“ ì´ APIê°€ í•„ìš”í•œê°€?

#### í•„ìš”í•˜ë‹¤:

**ì´ìœ **:
1. **HAMA í•µì‹¬ ê¸°ëŠ¥**: Human-in-the-Loop ì‹œì—°
2. **ì°¨ë³„í™” í¬ì¸íŠ¸**: ë‹¨ìˆœ ì¡°íšŒê°€ ì•„ë‹Œ AI ì œì•ˆ
3. **ì‚¬ìš©ì ê°€ì¹˜**: ì „ë¬¸ê°€ ìˆ˜ì¤€ ë¦¬ë°¸ëŸ°ì‹±

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì‚¬ìš©ìê°€ "ë¦¬ë°¸ëŸ°ì‹± í•´ì¤˜" ì±„íŒ…
2. ì—ì´ì „íŠ¸ê°€ ë¶„ì„ í›„ ì œì•ˆ
3. HITL íŒ¨ë„ì—ì„œ ìŠ¹ì¸/ê±°ë¶€
4. ìŠ¹ì¸ ì‹œ ì‹¤ì œ ë§¤ë§¤ (Trading Agent)

#### ì£¼ì˜ì‚¬í•­:

**HITL í†µí•© í•„ìˆ˜**:
- `requires_approval = true` ì²˜ë¦¬
- `approval_request` êµ¬ì¡° ë§ì¶¤
- `/chat/approve` ì—°ë™

**Trading Agent ì˜ì¡´**:
- ë¦¬ë°¸ëŸ°ì‹± ìŠ¹ì¸ í›„ ì‹¤ì œ ë§¤ë§¤ ì‹¤í–‰
- Phase 1-2ì—ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ë§Œ?

### âœ… ê¶Œì¥ì‚¬í•­

#### Phase 4 êµ¬í˜„ (ì¶”ì²œ)

**ì´ìœ **:
- HITL íŒ¨ë„ ì•ˆì •í™” ì„ í–‰ í•„ìš”
- Trading Agent ì™„ì„± í•„ìš”
- Performance APIë³´ë‹¤ ìš°ì„ ìˆœìœ„ ë‚®ìŒ

**Phase 4 ì‘ì—…**:
1. HITL íŒ¨ë„ì— ë¦¬ë°¸ëŸ°ì‹± ì „ìš© UI ì¶”ê°€
2. ëª©í‘œ ë¹„ì¤‘ ì¡°ì • ê¸°ëŠ¥ (ì„ íƒ)
3. ì‹¤ì œ ë§¤ë§¤ ì—°ë™ (Trading Agent)

**ì‹œì—° ëŒ€ë¹„**:
- Phase 3: ë²„íŠ¼ë§Œ ì¶”ê°€, "Coming Soon" í‘œì‹œ
- Phase 4: ì™„ì „ êµ¬í˜„

### ğŸ”§ ë°±ì—”ë“œ ìˆ˜ì • í•„ìš”ì‚¬í•­

1. **OpenAPI ìŠ¤í‚¤ë§ˆ ì¶”ê°€**
2. **HITL ë©”ì‹œì§€ í˜•ì‹ í†µì¼** (`docs/HITLFrontendContract.md` ì°¸ì¡°)
3. **`trades` êµ¬ì¡° ëª…í™•í™”** (ì–´ë–¤ í•„ë“œ í¬í•¨?)

### ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… í•­ëª©

1. ğŸ”² **Phase 3**: "ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ë°›ê¸°" ë²„íŠ¼ ì¶”ê°€ (Coming Soon)
2. ğŸ”² **Phase 4**: HITL íŒ¨ë„ ë¦¬ë°¸ëŸ°ì‹± UI êµ¬í˜„
3. ğŸ”² **Phase 4**: `/chat/approve` ì—°ë™

---

## UI í†µí•© ì„¤ê³„ì•ˆ

### í˜„ì¬ `/portfolio` í˜ì´ì§€ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Portfolio                            â”‚  <- ì œëª©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ì´ í‰ê°€ê¸ˆì•¡] [ì´ ìˆ˜ìµë¥ ] [ì¢…ëª© ìˆ˜] [í˜„ê¸ˆ] â”‚  <- ìš”ì•½ ì¹´ë“œ 4ê°œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Treemap] [Pie] [Bar]                   â”‚  <- ì°¨íŠ¸ ì„ íƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [ì„ íƒëœ ì°¨íŠ¸ í‘œì‹œ]                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê°œì„ ì•ˆ (Phase 2-3)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Portfolio                            â”‚
â”‚ ìµœê·¼ ì—…ë°ì´íŠ¸: 3ë¶„ ì „ âŸ³                  â”‚  <- ì‹ ì„ ë„ í‘œì‹œ (ì‹ ê·œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ì´ í‰ê°€ê¸ˆì•¡] [ì´ ìˆ˜ìµë¥ ] [ì¢…ëª© ìˆ˜] [í˜„ê¸ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Treemap] [Pie] [Bar]                   â”‚
â”‚ ê·¸ë£¹í™”: [ì¢…ëª©ë³„ â–¼] [ì„¹í„°ë³„]              â”‚  <- ê·¸ë£¹í™” ì˜µì…˜ (ì‹ ê·œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [ì„ íƒëœ ì°¨íŠ¸ + í˜„ê¸ˆ í¬í•¨]         â”‚  <- í˜„ê¸ˆ í¬í•¨ (ê°œì„ )
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ ì„±ê³¼ ì§€í‘œ                             â”‚  <- ì‹ ê·œ ì„¹ì…˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚ì—°ìˆ˜ìµâ”‚ìƒ¤í”„ â”‚ MDD  â”‚                  â”‚
â”‚ â”‚ 15% â”‚ 1.8 â”‚-12% â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚ [ë³€ë™ì„±] [VaR] [Beta]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ë°›ê¸°]                     â”‚  <- Phase 4
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
PortfolioView.tsx
â”œâ”€â”€ PortfolioHeader.tsx (ì‹ ê·œ)
â”‚   â”œâ”€â”€ ì œëª©
â”‚   â””â”€â”€ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸
â”œâ”€â”€ PortfolioSummary.tsx (ê¸°ì¡´)
â”œâ”€â”€ ChartSection.tsx (ì‹ ê·œ)
â”‚   â”œâ”€â”€ ChartTypeSelector.tsx (ê¸°ì¡´)
â”‚   â”œâ”€â”€ ChartGroupBySelector.tsx (ì‹ ê·œ)
â”‚   â”œâ”€â”€ PortfolioTreemap.tsx (ê¸°ì¡´, ê°œì„ )
â”‚   â”œâ”€â”€ PortfolioPieChart.tsx (ê¸°ì¡´, ê°œì„ )
â”‚   â””â”€â”€ PortfolioBarChart.tsx (ê¸°ì¡´)
â”œâ”€â”€ PortfolioPerformance.tsx (ì‹ ê·œ, Phase 2)
â”‚   â”œâ”€â”€ MetricCard.tsx
â”‚   â””â”€â”€ DetailMetric.tsx
â””â”€â”€ RebalanceButton.tsx (ì‹ ê·œ, Phase 4)
```

---

## ë°±ì—”ë“œ ê°œì„  ê¶Œì¥ì‚¬í•­

### ğŸ”´ ì¦‰ì‹œ ìˆ˜ì • (Critical)

1. **ì¤‘ë³µ í•¸ë“¤ëŸ¬ ì œê±°** (`/chart-data`)
   - `portfolio.py:379-487` ë˜ëŠ” `539-710` ì¤‘ í•˜ë‚˜ë§Œ ë‚¨ê¸°ê¸°
   - í˜„ì¬ëŠ” line 539ê°€ ì‹¤ì œ ë™ì‘ (query param ì„ íƒ, PortfolioSummary ìŠ¤í‚¤ë§ˆ ë°˜í™˜)
   - OpenAPI ë¬¸ì„œ ì—…ë°ì´íŠ¸

2. **OpenAPI ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ ìˆ˜ì •**
   - `/chart-data`: OpenAPIëŠ” `PortfolioChartData` ì •ì˜, ì‹¤ì œëŠ” `PortfolioSummary` ë°˜í™˜
   - í•„ë“œëª… ë¶ˆì¼ì¹˜: `stocks` â†’ `positions`, `cash` â†’ `cash_balance`
   - íƒ€ì… ë¶ˆì¼ì¹˜: `number` â†’ `string` (Decimal)

### ğŸŸ¡ Phase 2 (Medium)

2. **OpenAPI ìŠ¤í‚¤ë§ˆ ì¶”ê°€**
   - `/performance` ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
   - `/rebalance` ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
   - `/chart-data` íŒŒë¼ë¯¸í„° ëª…í™•í™” (`required: false`)

3. **ì„¹í„° ì •ë³´ ê°œì„ **
   - `get_sector()` í•¨ìˆ˜ë¥¼ DART API ë˜ëŠ” DB ì¡°íšŒë¡œ ë³€ê²½
   - í˜„ì¬: í•˜ë“œì½”ë”© `"ê¸°íƒ€"` ë°˜í™˜
   - ëª©í‘œ: ì‹¤ì œ ì„¹í„° ì •ë³´ ì œê³µ

4. **íƒ€ì… ì¼ê´€ì„±**
   - `/portfolio/`: `number`
   - `/{portfolio_id}`: `string` (Decimal)
   - â†’ ëª¨ë‘ `number`ë¡œ í†µì¼ ê¶Œì¥

### ğŸŸ¢ Phase 3-4 (Low)

5. **API í†µí•© ê²€í† **
   - `/chart-data`ë¥¼ `/portfolio/` ì‘ë‹µì— í¬í•¨
   - ë˜ëŠ” ì™„ì „ ì‚­ì œ

6. **Performance API ê³„ì‚° ë¡œì§ ë¬¸ì„œí™”**
   - ì–´ë””ì„œ ê³„ì‚°í•˜ëŠ”ê°€?
   - ì‹¤ì‹œê°„ì¸ê°€, ë°°ì¹˜ì¸ê°€?
   - nullì´ ë˜ëŠ” ì¡°ê±´ì€?

7. **Rebalance HITL ë©”ì‹œì§€ í˜•ì‹**
   - `docs/HITLFrontendContract.md`ì™€ ì¼ì¹˜ì‹œí‚¤ê¸°

---

## í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ê³„íš

### Phase 2 (ì‹œì—° í•„ìˆ˜)

| ì‘ì—… | ìš°ì„ ìˆœìœ„ | ì˜ˆìƒ ì‹œê°„ | ë‹´ë‹¹ |
|------|----------|-----------|------|
| ì„¹í„° ì •ë³´ í™œìš© (í”„ë¡ íŠ¸ ë§¤í•‘) | P1 | 2ì‹œê°„ | - |
| í˜„ê¸ˆ í¬í•¨ ì°¨íŠ¸ | P1 | 2ì‹œê°„ | - |
| ë°ì´í„° ì‹ ì„ ë„ í‘œì‹œ | P2 | 1ì‹œê°„ | - |
| Performance API ì—°ë™ | P1 | 4ì‹œê°„ | - |
| Performance UI êµ¬í˜„ | P1 | 6ì‹œê°„ | - |
| íˆ´íŒ/ë„ì›€ë§ ì‘ì„± | P1 | 3ì‹œê°„ | - |
| **í•©ê³„** | | **18ì‹œê°„** | |

### Phase 3 (ì„ íƒ)

| ì‘ì—… | ìš°ì„ ìˆœìœ„ | ì˜ˆìƒ ì‹œê°„ |
|------|----------|-----------|
| Pie Chart ì„¹í„° ê·¸ë£¹í™” | P2 | 4ì‹œê°„ |
| Chart ë¹ˆ ìƒíƒœ UI | P2 | 2ì‹œê°„ |
| ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ | P2 | 2ì‹œê°„ |
| **í•©ê³„** | | **8ì‹œê°„** |

### Phase 4 (ì¶”í›„)

| ì‘ì—… | ìš°ì„ ìˆœìœ„ | ì˜ˆìƒ ì‹œê°„ |
|------|----------|-----------|
| ë¦¬ë°¸ëŸ°ì‹± ë²„íŠ¼ | P3 | 1ì‹œê°„ |
| ë¦¬ë°¸ëŸ°ì‹± HITL UI | P3 | 8ì‹œê°„ |
| ë©€í‹° í¬íŠ¸í´ë¦¬ì˜¤ UI | P3 | 12ì‹œê°„ |
| **í•©ê³„** | | **21ì‹œê°„** |

---

## ì‹¤ì œ í…ŒìŠ¤íŠ¸ ìš”ì•½

| API | í…ŒìŠ¤íŠ¸ ì¼ì‹œ | ìƒíƒœ | OpenAPI ì¼ì¹˜ | ë¹„ê³  |
|-----|------------|------|--------------|------|
| `GET /portfolio/` | 2025-01-26 17:47 | âœ… 200 OK | âœ… ì™„ì „ ì¼ì¹˜ | ì„¹í„° ì •ë³´ ì •ìƒ ì œê³µ |
| `GET /portfolio/chart-data` | 2025-01-26 17:47 | âœ… 200 OK | âŒ **ë¶ˆì¼ì¹˜** | í•„ë“œëª…/íƒ€ì… ë‹¤ë¦„, ì‹¤ì œëŠ” PortfolioSummary êµ¬ì¡° |
| `GET /portfolio/{id}` | 2025-01-26 17:46 | âœ… 200 OK | âœ… ì¼ì¹˜ | Decimal string íƒ€ì…, CASH position í¬í•¨ |
| `GET /portfolio/{id}/performance` | 2025-01-26 17:47 | âœ… 200 OK | âš ï¸ ë¶€ë¶„ ì¼ì¹˜ | Betaê°€ Object, null í•„ë“œ ë§ìŒ |
| `POST /portfolio/{id}/rebalance` | - | âŒ ë¯¸í…ŒìŠ¤íŠ¸ | - | HITL í†µí•© í•„ìš” |

**í•µì‹¬ ë°œê²¬**:
1. âœ… ëª¨ë“  API ì •ìƒ ì‘ë™
2. âœ… ì„¹í„° ì •ë³´ ì œê³µë¨ (í”„ë¡ íŠ¸ ë¯¸í™œìš© ì¤‘)
3. âŒ `/chart-data` OpenAPI ìŠ¤í‚¤ë§ˆ ì™„ì „ ë¶ˆì¼ì¹˜
4. âš ï¸ Performance APIì˜ BetaëŠ” ì¢…ëª©ë³„, ê°€ì¤‘í‰ê·  ê³„ì‚° í•„ìš”
5. âš ï¸ í˜„ê¸ˆì´ "CASH" positionìœ¼ë¡œ í¬í•¨ë¨

---

**ë¬¸ì„œ ë²„ì „**: 3.0 (ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê¸°ë°˜)
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-01-26 17:50 KST
**ë‹¤ìŒ ì‘ì—…**: Stocks API ì™„ì „ ë¶„ì„
