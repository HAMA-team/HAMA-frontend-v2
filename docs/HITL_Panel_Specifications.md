# HITL Panel Specifications by Agent

**Date**: 2025-10-31
**Status**: Design Phase - For Backend Interrupt Implementation
**Purpose**: ê° Agentë³„ HITL íŒ¨ë„ UI êµ¬ì¡° ì •ì˜

---

## Overview

ë°±ì—”ë“œì—ì„œ ê° Agentì— interruptë¥¼ ì¶”ê°€í•  ì˜ˆì •ì´ë¯€ë¡œ,
í”„ë¡ íŠ¸ì—”ë“œëŠ” Agentë³„ë¡œ ë‹¤ë¥¸ HITL íŒ¨ë„ UIë¥¼ ì¤€ë¹„í•´ì•¼ í•¨.

### ê° Agentë³„ ìŠ¹ì¸ ëŒ€ìƒ ìš”ì•½

| Agent | ìŠ¹ì¸ë°›ëŠ” ì‘ì—… | ì‚¬ìš©ìê°€ í™•ì¸í•˜ëŠ” ê²ƒ |
|-------|------------|------------------|
| **Research** | ì¢…ëª© ë¶„ì„ ì‹¤í–‰ | ë¶„ì„í•  ì¢…ëª©, ì˜ˆìƒ ì‘ì—… ë‚´ìš© |
| **Strategy** | íˆ¬ì ì „ëµ ì ìš© | ì „ëµ ìœ í˜•, ì„¹í„° ë¹„ì¤‘, ì˜ˆìƒ ìˆ˜ìµë¥ /ë¦¬ìŠ¤í¬ |
| **Portfolio** | í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë°¸ëŸ°ì‹± | ë§¤ìˆ˜/ë§¤ë„ ì¢…ëª© ëª©ë¡, í•„ìš” ê¸ˆì•¡, ì˜ˆìƒ ë¹„ì¤‘ ë³€í™” |
| **Risk** | ê³ ìœ„í—˜ ìƒí™©ì—ì„œ ì§„í–‰ | ë¦¬ìŠ¤í¬ ìš”ì¸, í¬íŠ¸í´ë¦¬ì˜¤ ì§€í‘œ, ì™„í™” ë°©ë²• |
| **Trading** | ê°œë³„ ë§¤ë§¤ ì£¼ë¬¸ ì‹¤í–‰ | ì¢…ëª©, ìˆ˜ëŸ‰, ê¸ˆì•¡, í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ì¤‘ ë³€í™” |

---

## 1. Research Agent - ë¶„ì„ ì‹¤í–‰ ìŠ¹ì¸

### Interrupt ì‹œì  (ë°±ì—”ë“œ êµ¬í˜„ ì˜ˆì •):
- **Master Agentì—ì„œ Research Agent ì‹¤í–‰ ì „** (ê¶Œì¥)
  - ìœ„ì¹˜: `multi_agent_stream.py:140` (agent ì‹¤í–‰ for loop ì‹œì‘ ì „)
  - ì´ìœ : ì‘ì—… ì‹œì‘ ì „ ìŠ¹ì¸ìœ¼ë¡œ ëª…í™•í•œ UX
- ~~`synthesis_node` ì™„ë£Œ í›„~~ (ë¹„ê¶Œì¥)
  - ì´ìœ : ì´ë¯¸ Worker ì‹¤í–‰ ì™„ë£Œ í›„ ê±°ë¶€í•˜ë©´ ë¹„íš¨ìœ¨ì 

### Interrupt ì¡°ê±´ (ë³µì¡ë„ ê¸°ë°˜ HITL):

**ë¬¸ì œì :**
- ë‹¨ìˆœ ì§ˆë¬¸("ì‹œì¥ ì „ë§ì€?")ë„ Research Agent ì „ì²´ ìŠ¹ì¸ í•„ìš” â†’ ê³¼ë„í•¨
- ë³µì¡í•œ ë¶„ì„("ì‚¼ì„±ì „ì ì¢…í•© ë¶„ì„")ê³¼ ë™ì¼í•œ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ â†’ ë¹„íš¨ìœ¨

**í•´ê²°ì±…: Routerì˜ ë³µì¡ë„ íŒë‹¨ í™œìš©**

Routerê°€ ì´ë¯¸ ì œê³µí•˜ëŠ” ì •ë³´:
- `query_complexity`: "simple" | "moderate" | "expert"
- `depth_level`: "brief" | "detailed" | "comprehensive"
- `user_intent`: "quick_info" | "stock_analysis" | ...

```python
# ë°±ì—”ë“œ êµ¬í˜„ ì˜ˆì‹œ (multi_agent_stream.py)
routing_decision = await route_query(message, user_profile)

for agent_name in routing_decision.agents_to_call:
    should_interrupt = False

    if agent_name == "research":
        if automation_level == "Advisor":
            # Expert ìˆ˜ì¤€ì´ê±°ë‚˜ Comprehensive ë¶„ì„ë§Œ ìŠ¹ì¸ ìš”ì²­
            if routing_decision.query_complexity == "expert" or \
               routing_decision.depth_level == "comprehensive":
                should_interrupt = True
            # Simple/ModerateëŠ” ìë™ ì‹¤í–‰
        # Copilot/Pilot: ìë™ ì‹¤í–‰

    elif agent_name == "strategy":
        if automation_level == "Advisor":
            should_interrupt = True

    elif agent_name == "portfolio":
        if automation_level in ["Advisor", "Copilot"]:
            should_interrupt = True

    elif agent_name == "trading":
        # ëª¨ë“  ë ˆë²¨ì—ì„œ ìŠ¹ì¸ í•„ìš”
        should_interrupt = True

    if should_interrupt:
        interrupt({...})

    # Agent ì‹¤í–‰
    result = await agent.ainvoke(...)
```

**ê²°ê³¼ (Advisor ë ˆë²¨ ê¸°ì¤€):**

| ì‚¬ìš©ì ì§ˆë¬¸ | complexity | depth | Research HITL? | ì´ìœ  |
|-----------|-----------|-------|---------------|------|
| "ì‹œì¥ ì „ë§ì€?" | simple | brief | âŒ ìë™ ì‹¤í–‰ | macro_workerë§Œ, ë‹¨ìˆœ ì¡°íšŒ |
| "ì‚¼ì„±ì „ì í˜„ì¬ê°€?" | simple | brief | âŒ ìë™ ì‹¤í–‰ | data_workerë§Œ, ë‹¨ìˆœ ì¡°íšŒ |
| "ì‚¼ì„±ì „ì ëª©í‘œê°€ëŠ”?" | moderate | detailed | âŒ ìë™ ì‹¤í–‰ | data+bull, ì¤‘ê°„ ë³µì¡ë„ |
| "ì‚¼ì„±ì „ì ì¢…í•© ë¶„ì„í•´ì¤˜" | expert | comprehensive | âœ… ìŠ¹ì¸ í•„ìš” | ëª¨ë“  Worker, ë³µì¡í•œ ë¶„ì„ |
| "ì‚¼ì„±ì „ì ì‹¬ì¸µ ë¦¬ìŠ¤í¬ ë¶„ì„" | expert | comprehensive | âœ… ìŠ¹ì¸ í•„ìš” | ì „ë¬¸ê°€ ìˆ˜ì¤€ ë¶„ì„ |

**ì¥ì :**
- ë‹¨ìˆœ ì§ˆë¬¸ì— ê³¼ë„í•œ ìŠ¹ì¸ ìš”ì²­ ë°©ì§€
- ë³µì¡í•œ ë¶„ì„ë§Œ ìŠ¹ì¸ë°›ì•„ íš¨ìœ¨ì 
- Routerê°€ ì´ë¯¸ íŒë‹¨í•˜ë¯€ë¡œ ì¶”ê°€ LLM í˜¸ì¶œ ë¶ˆí•„ìš”

### ìŠ¹ì¸ ëŒ€ìƒ:
- Research Agent ì „ì²´ ì‹¤í–‰ (ë‚´ë¶€ WorkerëŠ” ìë™ ì„ íƒë¨)
- ì‚¬ìš©ìëŠ” ì–´ë–¤ Worker(data/bull/bear/macro/insight)ê°€ ì‹¤í–‰ë ì§€ ëª°ë¼ë„ ë¨
- planner_nodeê°€ LLMìœ¼ë¡œ ë™ì  ì„ íƒ (ì°¸ê³ : `docs/Research_Agent_Dynamic_Routing.md`)

### íŒ¨ë„ êµ¬ì¡°:

```typescript
interface ResearchApprovalPayload {
  type: "research_approval";
  agent: "Research";
  stock_code: string;
  stock_name: string;
  query: string;                      // ì‚¬ìš©ì ì§ˆë¬¸
  routing_reason: string;             // Routerê°€ Research Agentë¥¼ ì„ íƒí•œ ì´ìœ 
  query_complexity: "simple" | "moderate" | "expert";  // Router íŒë‹¨
  depth_level: "brief" | "detailed" | "comprehensive"; // Router íŒë‹¨
  expected_workers: string[];         // planner_nodeê°€ ì„ íƒí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” Worker (ì°¸ê³ ìš©)
  automation_level: "Advisor";        // Pilot/Copilotì€ ì´ íŒ¨ë„ ì•ˆ ëœ¸
}
```

### UI êµ¬ì„±:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Research Agent ì‹¤í–‰ ìŠ¹ì¸               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì¢…ëª©: ì‚¼ì„±ì „ì (005930)                   â”‚
â”‚ ì§ˆë¬¸: "ì‚¼ì„±ì „ì ì¢…í•© ë¶„ì„í•´ì¤˜"             â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š ë¶„ì„ ë³µì¡ë„: Expert (ì „ë¬¸ê°€ ìˆ˜ì¤€)       â”‚
â”‚ ğŸ“– ë¶„ì„ ê¹Šì´: Comprehensive (ì¢…í•© ë¶„ì„)    â”‚
â”‚                                         â”‚
â”‚ ğŸ“‹ ì‹¤í–‰ ì˜ˆì • ì‘ì—…:                        â”‚
â”‚ - ğŸ“Š ë°ì´í„° ìˆ˜ì§‘ (ì£¼ê°€, ì¬ë¬´ì œí‘œ)          â”‚
â”‚ - ğŸ‚ ë‚™ê´€ì  ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„                  â”‚
â”‚ - ğŸ» ë³´ìˆ˜ì  ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„                  â”‚
â”‚ - ğŸ§  ì¢…í•© ì¸ì‚¬ì´íŠ¸ ë„ì¶œ                    â”‚
â”‚                                         â”‚
â”‚ â„¹ï¸ ìë™í™” ë ˆë²¨: Advisor                   â”‚
â”‚ ğŸ’¡ ë‹¨ìˆœ ì§ˆë¬¸ì€ ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤             â”‚
â”‚                                         â”‚
â”‚ [ìŠ¹ì¸] [ê±°ë¶€]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Note:** Worker ëª©ë¡ì€ planner_nodeê°€ ë™ì ìœ¼ë¡œ ì„ íƒí•˜ë¯€ë¡œ,
ì‹¤ì œë¡œëŠ” "ë¶„ì„ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤" ì •ë„ë¡œë§Œ í‘œì‹œí•˜ê³ 
êµ¬ì²´ì ì¸ Worker ëª©ë¡ì€ í‘œì‹œí•˜ì§€ ì•ŠëŠ” ê²ƒì„ ê¶Œì¥.
(ì‚¬ìš©ìê°€ Worker ê°œë…ì„ ì´í•´í•  í•„ìš” ì—†ìŒ)

### ì•¡ì…˜:
- **ìŠ¹ì¸**: Research Agent ì‹¤í–‰ â†’ planner_nodeê°€ Worker ì„ íƒ â†’ ë¶„ì„ ì§„í–‰
- **ê±°ë¶€**: Research Agent ê±´ë„ˆë›°ê³  General Agentë¡œ ë‹µë³€
  - ì˜ˆ: "ì£„ì†¡í•©ë‹ˆë‹¤. ë¶„ì„ì„ ì§„í–‰í•˜ì§€ ì•Šê³  ì¼ë°˜ì ì¸ ì •ë³´ë§Œ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤."

---

## 2. Strategy Agent - íˆ¬ì ì „ëµ ìŠ¹ì¸

### Interrupt ì‹œì  (ë°±ì—”ë“œ êµ¬í˜„ ì˜ˆì •):
- `blueprint_creation_node` ì™„ë£Œ í›„
- íˆ¬ì ì „ëµ ìƒì„± ì™„ë£Œ ì‹œ

### íŒ¨ë„ êµ¬ì¡°:

```typescript
interface StrategyApprovalPayload {
  type: "strategy_approval";
  strategy_type: "MOMENTUM" | "VALUE" | "GROWTH" | "DEFENSIVE";
  market_outlook: {
    cycle: "expansion" | "peak" | "contraction" | "trough";
    sentiment: "bullish" | "neutral" | "bearish";
  };
  sector_strategy: {
    overweight: string[];    // ë¹„ì¤‘ í™•ëŒ€ ì„¹í„°
    underweight: string[];   // ë¹„ì¤‘ ì¶•ì†Œ ì„¹í„°
  };
  target_allocation: {
    stocks: number;          // ì£¼ì‹ ë¹„ì¤‘ (%)
    cash: number;            // í˜„ê¸ˆ ë¹„ì¤‘ (%)
  };
  expected_return: number;   // ì˜ˆìƒ ìˆ˜ìµë¥  (%)
  expected_risk: "low" | "medium" | "high";
}
```

### UI êµ¬ì„±:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ íˆ¬ì ì „ëµ ìŠ¹ì¸                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì „ëµ ìœ í˜•: ëª¨ë©˜í…€ ì „ëµ                    â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š ì‹œì¥ ì „ë§:                             â”‚
â”‚ - ì‚¬ì´í´: í™•ì¥ê¸° (Expansion)              â”‚
â”‚ - ì‹¬ë¦¬: ê°•ì„¸ì¥ (Bullish)                 â”‚
â”‚                                         â”‚
â”‚ ğŸ”„ ì„¹í„° ì „ëµ:                             â”‚
â”‚ ë¹„ì¤‘ í™•ëŒ€ â¬†ï¸: ë°˜ë„ì²´, ë°°í„°ë¦¬              â”‚
â”‚ ë¹„ì¤‘ ì¶•ì†Œ â¬‡ï¸: ì€í–‰, ë³´í—˜                  â”‚
â”‚                                         â”‚
â”‚ ğŸ“ˆ ëª©í‘œ ìì‚°ë°°ë¶„:                         â”‚
â”‚ - ì£¼ì‹: 80%                              â”‚
â”‚ - í˜„ê¸ˆ: 20%                              â”‚
â”‚                                         â”‚
â”‚ ğŸ’° ì˜ˆìƒ ìˆ˜ìµë¥ : 15% (ì—°í™˜ì‚°)              â”‚
â”‚ âš ï¸ ì˜ˆìƒ ë¦¬ìŠ¤í¬: Medium                   â”‚
â”‚                                         â”‚
â”‚ [ì‹œë®¬ë ˆì´ì…˜ ë³´ê¸°] [ìŠ¹ì¸] [ê±°ë¶€] [ì¡°ì •]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì•¡ì…˜:
- **ìŠ¹ì¸**: Portfolio Agentë¡œ ì§„í–‰
- **ê±°ë¶€**: "ë” ì•ˆì „í•œ ì „ëµ ì¶”ì²œí•´ì¤˜"
- **ì¡°ì •**: ì„¹í„° ë¹„ì¤‘/ìì‚°ë°°ë¶„ ìˆ˜ì • UI í‘œì‹œ

---

## 3. Portfolio Agent - í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ìŠ¹ì¸

### Interrupt ì‹œì  (ë°±ì—”ë“œ êµ¬í˜„ ì˜ˆì •):
- `rebalance_plan_node` ì™„ë£Œ í›„
- ë¦¬ë°¸ëŸ°ì‹± ê³„íš ìƒì„± ì‹œ

### íŒ¨ë„ êµ¬ì¡°:

```typescript
interface PortfolioApprovalPayload {
  type: "portfolio_approval";
  rebalancing_needed: boolean;
  current_holdings: Array<{
    stock_code: string;
    stock_name: string;
    quantity: number;
    current_weight: number;
  }>;
  proposed_allocation: Array<{
    stock_code: string;
    stock_name: string;
    target_weight: number;
    action: "BUY" | "SELL" | "HOLD";
    quantity_change: number;
  }>;
  trades_required: Array<{
    stock_code: string;
    order_type: "buy" | "sell";
    quantity: number;
    estimated_amount: number;
  }>;
  portfolio_metrics: {
    expected_return: number;
    expected_risk: number;
    diversification_score: number;
  };
}
```

### UI êµ¬ì„±:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ë°¸ëŸ°ì‹±                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”„ í•„ìš”í•œ ê±°ë˜:                           â”‚
â”‚                                         â”‚
â”‚ ğŸ“ˆ ë§¤ìˆ˜:                                 â”‚
â”‚ - ì‚¼ì„±ì „ì (005930): 10ì£¼ (+763,000ì›)   â”‚
â”‚ - LGí™”í•™ (051910): 5ì£¼ (+2,150,000ì›)   â”‚
â”‚                                         â”‚
â”‚ ğŸ“‰ ë§¤ë„:                                 â”‚
â”‚ - KBê¸ˆìœµ (105560): 20ì£¼ (-1,020,000ì›)  â”‚
â”‚                                         â”‚
â”‚ ğŸ’µ ì´ í•„ìš” ê¸ˆì•¡: 1,893,000ì›             â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š ì˜ˆìƒ í¬íŠ¸í´ë¦¬ì˜¤:                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ ë°˜ë„ì²´: 45% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚                â”‚
â”‚ â”‚ ë°°í„°ë¦¬: 30% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â”‚                â”‚
â”‚ â”‚ í˜„ê¸ˆ: 25% â–ˆâ–ˆâ–ˆâ–ˆ       â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                         â”‚
â”‚ ğŸ’¡ ì˜ˆìƒ ìˆ˜ìµë¥ : 12%                      â”‚
â”‚ âš ï¸ ë¦¬ìŠ¤í¬: Medium                        â”‚
â”‚ ğŸ¯ ë¶„ì‚°ë„: 8/10                          â”‚
â”‚                                         â”‚
â”‚ [ë¹„ì¤‘ ì¡°ì •] [ìŠ¹ì¸] [ê±°ë¶€]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì•¡ì…˜:
- **ìŠ¹ì¸**: Trading Agentë¡œ ë§¤ë§¤ ì‹¤í–‰
- **ê±°ë¶€**: í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ìœ ì§€
- **ë¹„ì¤‘ ì¡°ì •**: ë“œë˜ê·¸ë¡œ ì„¹í„° ë¹„ì¤‘ ìˆ˜ì • â†’ ì¬ê³„ì‚°

---

## 4. Risk Agent - ë¦¬ìŠ¤í¬ ê²½ê³  í™•ì¸

### Interrupt ì‹œì  (ë°±ì—”ë“œ êµ¬í˜„ ê³ ë ¤):
- ê³ ìœ„í—˜ ìƒí™© ê°ì§€ ì‹œ
- ì˜ˆ: í¬íŠ¸í´ë¦¬ì˜¤ ì§‘ì¤‘ë„ > 50%, ë³€ë™ì„± > threshold

### íŒ¨ë„ êµ¬ì¡°:

```typescript
interface RiskApprovalPayload {
  type: "risk_approval";
  risk_level: "low" | "medium" | "high";
  risk_factors: Array<{
    category: string;
    severity: "warning" | "critical";
    description: string;
    mitigation: string;
  }>;
  portfolio_metrics: {
    concentration: number;     // ì§‘ì¤‘ë„ (%)
    volatility: number;        // ë³€ë™ì„± (%)
    max_drawdown: number;      // ìµœëŒ€ ë‚™í­ (%)
  };
}
```

### UI êµ¬ì„±:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ ë¦¬ìŠ¤í¬ ê²½ê³                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ ê³ ìœ„í—˜ ìƒí™© ê°ì§€                       â”‚
â”‚                                         â”‚
â”‚ ì£¼ìš” ë¦¬ìŠ¤í¬:                              â”‚
â”‚                                         â”‚
â”‚ âš ï¸ ê²½ê³ : í¬íŠ¸í´ë¦¬ì˜¤ ì§‘ì¤‘ë„ ë†’ìŒ           â”‚
â”‚ - ì‚¼ì„±ì „ì ë¹„ì¤‘ 35% (ê¶Œì¥: 20% ì´í•˜)     â”‚
â”‚ - ì™„í™” ë°©ë²•: ë‹¤ë¥¸ ì„¹í„° ì¶”ê°€ ë§¤ìˆ˜          â”‚
â”‚                                         â”‚
â”‚ ğŸ”´ ì‹¬ê°: ì‹œì¥ ë³€ë™ì„± ê¸‰ì¦                 â”‚
â”‚ - VIX ì§€ìˆ˜ 30 ëŒíŒŒ                       â”‚
â”‚ - ì™„í™” ë°©ë²•: í˜„ê¸ˆ ë¹„ì¤‘ í™•ëŒ€ ê¶Œì¥          â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ì§€í‘œ:                       â”‚
â”‚ - ì§‘ì¤‘ë„: 55% âš ï¸                         â”‚
â”‚ - ë³€ë™ì„±: 18% âš ï¸                         â”‚
â”‚ - ìµœëŒ€ ë‚™í­: -15%                        â”‚
â”‚                                         â”‚
â”‚ ğŸ’¡ ê¶Œì¥ ì¡°ì¹˜:                             â”‚
â”‚ - ì‚¼ì„±ì „ì ë¹„ì¤‘ ì¶•ì†Œ (35% â†’ 20%)         â”‚
â”‚ - í˜„ê¸ˆ ë¹„ì¤‘ í™•ëŒ€ (10% â†’ 25%)             â”‚
â”‚                                         â”‚
â”‚ [ê²½ê³  ë¬´ì‹œí•˜ê³  ì§„í–‰] [ê¶Œì¥ ì¡°ì¹˜ ì ìš©] [ì·¨ì†Œ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì•¡ì…˜:
- **ê²½ê³  ë¬´ì‹œ**: ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ (ì‚¬ìš©ì ì±…ì„)
- **ê¶Œì¥ ì¡°ì¹˜ ì ìš©**: ë¦¬ë°¸ëŸ°ì‹± ê³„íš ìˆ˜ì • â†’ Portfolio Agent ì¬ì‹¤í–‰
- **ì·¨ì†Œ**: ì „ì²´ ì‘ì—… ì¤‘ë‹¨

---

## 5. Trading Agent - ë§¤ë§¤ ì£¼ë¬¸ ìŠ¹ì¸ (ê¸°ì¡´)

### Interrupt ì‹œì  (ì´ë¯¸ êµ¬í˜„ë¨):
- `approval_trade_node`

### íŒ¨ë„ êµ¬ì¡° (ê¸°ì¡´):

```typescript
interface TradingApprovalPayload {
  type: "trade_approval";
  stock_code: string;
  stock_name: string;
  order_type: "buy" | "sell";
  quantity: number;
  estimated_price: number;
  total_amount: number;
  risk_level: "low" | "medium" | "high";
  risk_factors: string[];
  current_portfolio_weight: number;
  expected_portfolio_weight: number;
}
```

### UI êµ¬ì„± (ê¸°ì¡´ ìœ ì§€):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° ë§¤ë§¤ ì£¼ë¬¸ ìŠ¹ì¸                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì¢…ëª©: ì‚¼ì„±ì „ì (005930)                   â”‚
â”‚ ì£¼ë¬¸ ìœ í˜•: ë§¤ìˆ˜                           â”‚
â”‚ ìˆ˜ëŸ‰: 10ì£¼                               â”‚
â”‚ ì˜ˆìƒ ê°€ê²©: 76,300ì›                       â”‚
â”‚ ì´ ê¸ˆì•¡: 763,000ì›                        â”‚
â”‚                                         â”‚
â”‚ âš ï¸ ë¦¬ìŠ¤í¬: Medium                        â”‚
â”‚ - í¬íŠ¸í´ë¦¬ì˜¤ ì§‘ì¤‘ë„ ì¦ê°€ (25% â†’ 35%)      â”‚
â”‚ - ì‹œì¥ ë³€ë™ì„± ë†’ìŒ                        â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š í˜„ì¬ ë¹„ì¤‘: 25%                         â”‚
â”‚ ğŸ“ˆ ì˜ˆìƒ ë¹„ì¤‘: 35%                         â”‚
â”‚                                         â”‚
â”‚ [ìŠ¹ì¸] [ê±°ë¶€] [ìˆ˜ëŸ‰ ìˆ˜ì •]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Worker ë ˆë²¨ HITL (ì„ íƒì  ì»¤ìŠ¤í…€ êµ¬í˜„)

> **Note:** "ì„ íƒì  ì»¤ìŠ¤í…€ êµ¬í˜„"ì´ë€, í–¥í›„ ê³ ê¸‰ ì‚¬ìš©ìë¥¼ ìœ„í•œ Custom Modeì—ì„œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê¸°ë³¸ 3ë‹¨ê³„ ìë™í™” ë ˆë²¨(Pilot/Copilot/Advisor)ì—ì„œëŠ” Agent ë ˆë²¨ HITLë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### í•„ìš”ì„± ê²€í† :

**Pros:**
- ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥ (ì˜ˆ: "bull_workerë§Œ ì‹¤í–‰í•˜ê³  bear_workerëŠ” ê±´ë„ˆë›°ê¸°")
- íŠ¹ì • ë¶„ì„ë§Œ ìŠ¹ì¸ ê°€ëŠ¥
- ê³ ê¸‰ ì‚¬ìš©ìê°€ ë‚´ë¶€ ë™ì‘ì„ ì´í•´í•˜ê³  ìˆë‹¤ë©´ ìœ ìš©

**Cons:**
- ì‚¬ìš©ìì—ê²Œ ë„ˆë¬´ ë³µì¡í•¨ (Workerê°€ ë­”ì§€ ëª¨ë¦„)
- Worker ì´ë¦„ì´ ë°±ì—”ë“œ êµ¬í˜„ì— ì¢…ì† (ë‚´ë¶€ ì„¸ë¶€ì‚¬í•­ ë…¸ì¶œ)
- UX ì €í•˜ (ìŠ¹ì¸ ìš”ì²­ì´ ë„ˆë¬´ ë§ìŒ)
- planner_nodeê°€ **ë™ì ìœ¼ë¡œ Workerë¥¼ ì„ íƒ**í•˜ë¯€ë¡œ, ì‚¬ìš©ìê°€ ë¯¸ë¦¬ Workerë¥¼ ì§€ì •í•˜ëŠ” ê²Œ ë¶ˆê°€ëŠ¥

### ë™ì  ë¼ìš°íŒ… ê³ ë ¤ì‚¬í•­:

Research AgentëŠ” planner_nodeê°€ LLMì„ ì‚¬ìš©í•˜ì—¬ **ì§ˆë¬¸ ë‚´ìš©ì— ë”°ë¼ ì‹¤í–‰í•  Workerë¥¼ ë™ì ìœ¼ë¡œ ì„ íƒ**í•©ë‹ˆë‹¤.

**ì˜ˆì‹œ:**
- "ì‚¼ì„±ì „ì ë¶„ì„í•´ì¤˜" â†’ {data, bull, bear, insight}
- "ì‚¼ì„±ì „ì ëª©í‘œê°€ëŠ”?" â†’ {data, bull}
- "ì‹œì¥ ì „ë§ì€?" â†’ {macro}

**ë¬¸ì œ:**
- ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ í•˜ê¸° ì „ê¹Œì§€ëŠ” ì–´ë–¤ Workerê°€ ì‹¤í–‰ë ì§€ ì•Œ ìˆ˜ ì—†ìŒ
- planner_node ì‹¤í–‰ í›„ì—ì•¼ Worker ëª©ë¡ì´ ê²°ì •ë¨
- ë”°ë¼ì„œ Worker ë ˆë²¨ HITLì„ êµ¬í˜„í•˜ë ¤ë©´:
  1. planner_node ì‹¤í–‰ (LLM í˜¸ì¶œ ë¹„ìš© ë°œìƒ)
  2. Worker ëª©ë¡ í™•ì¸
  3. ì‚¬ìš©ìì—ê²Œ "data/bull/bear ì‹¤í–‰í• ê¹Œìš”?" ë¬¼ì–´ë´„ â† **ì´ë¯¸ ë¹„ìš© ë°œìƒ í›„**
  4. ìŠ¹ì¸/ê±°ë¶€
  5. Worker ì‹¤í–‰

**ê²°ë¡ :** planner_nodeê°€ ë™ì ìœ¼ë¡œ ì„ íƒí•˜ë¯€ë¡œ, Worker ë ˆë²¨ HITLì€ **ê¸°ìˆ ì ìœ¼ë¡œ ê°€ëŠ¥í•˜ì§€ë§Œ UXì™€ ë¹„ìš© ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì **.

### ê¶Œì¥ ì‚¬í•­:

**âŒ Worker ë ˆë²¨ HITLì€ ê¶Œì¥í•˜ì§€ ì•ŠìŒ**

**ì´ìœ :**
- Agent ë ˆë²¨ HITLë§Œìœ¼ë¡œ ì¶©ë¶„íˆ ì œì–´ ê°€ëŠ¥ (ì‹¤í–‰ ì „ ìŠ¹ì¸)
- ì‚¬ìš©ìê°€ Worker ê°œë… ì´í•´ ë¶ˆí•„ìš” (ë‚´ë¶€ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­)
- ë™ì  ë¼ìš°íŒ… íŠ¹ì„±ìƒ, Worker ëª©ë¡ì€ ëŸ°íƒ€ì„ì— ê²°ì •ë¨
- í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ê²°í•©ë„ ì¦ê°€

**ëŒ€ì•ˆ:**
- Agent ë ˆë²¨ HITLë§Œ êµ¬í˜„ (Masterì—ì„œ Research Agent ì‹¤í–‰ ì „ ìŠ¹ì¸)
- Custom Modeì—ì„œ Phaseë³„ ì„¸ë¶€ ì„¤ì • ì œê³µ (Agent ë ˆë²¨)

**ì°¸ê³  ë¬¸ì„œ:**
- `docs/Research_Agent_Dynamic_Routing.md` - planner_node ë™ì‘ ë°©ì‹ ìƒì„¸

---

## 7. HITL ìƒíƒœ ì „ì´ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëŒ€í™” ì¤‘   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ (interrupt ë°œìƒ)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HITL íŒ¨ë„ ì˜¤í”ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ [ìŠ¹ì¸] â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚ ìŠ¤íŠ¸ë¦¼ ì¬ê°œ   â”‚ â”€â”€â†’ ë‹¤ìŒ ë‹¨ê³„
       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ [ê±°ë¶€] â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚ ëŒ€ì²´ ì œì•ˆ ìš”ì²­ â”‚ â”€â”€â†’ ìƒˆ ëŒ€í™”
       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â†’ [ìˆ˜ì •] â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ ì¬ë¶„ì„ ë¡œë”©   â”‚ â”€â”€â†’ íŒ¨ë„ ì¬ì˜¤í”ˆ
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. API ì—°ë™ ì‹œí€€ìŠ¤

```
Frontend                 Backend (SSE)              LangGraph
   |                         |                          |
   |  POST /chat/            |                          |
   |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                          |
   |                         |  invoke()                |
   |                         |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>|
   |                         |                          |
   |  event: agent_start     |                          |
   |<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          |
   |  (Thinking í‘œì‹œ)         |                          |
   |                         |                          |
   |  event: requires_approval|          interrupt()    |
   |<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<|
   |  (HITL íŒ¨ë„ ì˜¤í”ˆ)        |                          |
   |                         |          (ì¤‘ë‹¨)          |
   |                         |                          |
   |  ì‚¬ìš©ì ìŠ¹ì¸/ê±°ë¶€         |                          |
   |                         |                          |
   |  POST /chat/approve     |                          |
   |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                          |
   |                         |  Command(resume=...)     |
   |                         |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>|
   |                         |                          |
   |  event: agent_resume    |                          |
   |<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          |
   |  (Thinking ì¬í‘œì‹œ)       |                          |
   |                         |                          |
   |  event: agent_complete  |                          |
   |<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          |
   |  (ìµœì¢… ë‹µë³€)             |                          |
```

---

## 9. Implementation Checklist

### Backend (Bê°€ êµ¬í˜„):
- [ ] **Master Agent (multi_agent_stream.py)ì— interrupt ì¶”ê°€**
  - [ ] **ë³µì¡ë„ ê¸°ë°˜ HITL ë¡œì§ êµ¬í˜„** â­
    - [ ] Routerì˜ `query_complexity`, `depth_level` í™œìš©
    - [ ] Research Agent: expert/comprehensiveë§Œ ìŠ¹ì¸
    - [ ] Strategy/Portfolio/Trading: ê¸°ì¡´ ë¡œì§ ìœ ì§€
  - [ ] Research Agent ì‹¤í–‰ ì „ (line ~140, ì¡°ê±´ë¶€)
  - [ ] Strategy Agent ì‹¤í–‰ ì „
  - [ ] Portfolio Agent ì‹¤í–‰ ì „
  - [ ] Risk Agent ì‹¤í–‰ ì „ (ì¡°ê±´ë¶€)
  - [ ] Trading Agent ì‹¤í–‰ ì „ (ê¸°ì¡´ ìœ ì§€)
- [ ] ~~ê° Agent ë‚´ë¶€ synthesis nodeì— interrupt~~ (ë¹„ê¶Œì¥ - ë¹„íš¨ìœ¨)
- [ ] ê° interrupt payload ìŠ¤í‚¤ë§ˆ ì •ì˜
  - `ResearchApprovalPayload` (agent, stock_code, query, routing_reason, query_complexity, depth_level)
  - `StrategyApprovalPayload`
  - `PortfolioApprovalPayload`
  - `RiskApprovalPayload`
  - `TradingApprovalPayload`

### Frontend (ë‹¹ì‹ ì´ êµ¬í˜„):
- [ ] Agentë³„ HITL íŒ¨ë„ ì»´í¬ë„ŒíŠ¸ ìƒì„±
  - [ ] `ResearchApprovalPanel.tsx`
  - [ ] `StrategyApprovalPanel.tsx`
  - [ ] `PortfolioApprovalPanel.tsx`
  - [ ] `RiskApprovalPanel.tsx`
  - [ ] `TradingApprovalPanel.tsx` (ê¸°ì¡´ ìˆ˜ì •)
- [ ] HITL íŒ¨ë„ ë¼ìš°í„° êµ¬í˜„ (payload.type ê¸°ë°˜)
- [ ] ìƒíƒœ ê´€ë¦¬ (approved/rejected/modified)
- [ ] ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ëŒ€ë¡œ ìŠ¤íŠ¸ë¦¼ ì¬ê°œ ì²˜ë¦¬

---

## 10. ì°¸ê³  ë¬¸ì„œ

- `docs/Research_Agent_Dynamic_Routing.md` - Research Agent ë™ì  ë¼ìš°íŒ… (â­ ì‹ ê·œ)
- `docs/qa/Settings_Approvals_API_Complete_Design.md` - API ì„¤ê³„
- `docs/AutomationLevelIntegration.md` - Phase ë§¤í•‘
- `docs/AutomationLevelAPIChanges.md` - API ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­
- `docs/Userflow.md` - ì‚¬ìš©ì í”Œë¡œìš°
- `references/interrupts.md` - LangGraph interrupt ê³µì‹ ë¬¸ì„œ
- `references/subgraphs.md` - LangGraph subgraph ê³µì‹ ë¬¸ì„œ
