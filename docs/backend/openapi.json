{"openapi":"3.1.0","info":{"title":"HAMA 백엔드 API","description":"HAMA 투자 도우미의 백엔드 API 문서입니다.\n\n채팅 기반 분석, 포트폴리오 관리, 대시보드 통계를 비롯한 핵심 기능을 Swagger UI에서 바로 확인하고 테스트할 수 있습니다.","version":"v1"},"paths":{"/api/v1/chat/":{"post":{"tags":["chat"],"summary":"Chat","description":"메인 채팅 엔드포인트입니다.\n\n처리 흐름:\n1. 마스터 에이전트가 질의를 수신합니다.\n2. 적절한 서브 에이전트를 선택해 작업을 분배합니다.\n3. 서브 에이전트가 결과를 생성합니다.\n4. 마스터 에이전트가 결과를 통합합니다.\n5. HITL 조건을 확인하고 응답을 생성합니다.\n6. 중단 지점이 있는 경우 승인 요청을 반환합니다.","operationId":"chat_api_v1_chat__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/chat/history/{conversation_id}":{"get":{"tags":["chat"],"summary":"Get Chat History","description":"특정 대화의 메시지 히스토리를 조회합니다.","operationId":"get_chat_history_api_v1_chat_history__conversation_id__get","parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["chat"],"summary":"Delete Chat History","description":"특정 대화 히스토리를 영구 삭제합니다.","operationId":"delete_chat_history_api_v1_chat_history__conversation_id__delete","parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/chat/sessions":{"get":{"tags":["chat"],"summary":"List Chat Sessions","description":"최근 활동 순으로 정렬된 채팅 세션 목록을 반환합니다.","operationId":"list_chat_sessions_api_v1_chat_sessions_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":50,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ChatSessionSummary"},"title":"Response List Chat Sessions Api V1 Chat Sessions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/chat/approve":{"post":{"tags":["chat"],"summary":"Approve Action","description":"승인 혹은 거부 결정을 처리하는 엔드포인트입니다.\n\n처리 흐름:\n1. thread_id를 통해 중단된 그래프 상태를 조회합니다.\n2. 결정 값에 따라 Command(resume=...)를 전달합니다.\n3. 그래프를 재개하고 최종 결과를 반환합니다.","operationId":"approve_action_api_v1_chat_approve_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApprovalRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApprovalResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/dashboard/":{"get":{"tags":["dashboard"],"summary":"Get Dashboard","description":"대시보드 화면에 필요한 요약 정보를 제공합니다.","operationId":"get_dashboard_api_v1_dashboard__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DashboardPayload"}}}}}}},"/api/v1/portfolio/":{"get":{"tags":["portfolio"],"summary":"Get Portfolio Overview","description":"대시보드와 포트폴리오 화면에 필요한 요약 데이터를 제공합니다.","operationId":"get_portfolio_overview_api_v1_portfolio__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PortfolioOverview"}}}}}}},"/api/v1/portfolio/{portfolio_id}":{"get":{"tags":["portfolio"],"summary":"Get Portfolio","description":"지정한 포트폴리오의 세부 정보를 조회합니다.","operationId":"get_portfolio_api_v1_portfolio__portfolio_id__get","parameters":[{"name":"portfolio_id","in":"path","required":true,"schema":{"type":"string","title":"Portfolio Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PortfolioSummary"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/portfolio/{portfolio_id}/performance":{"get":{"tags":["portfolio"],"summary":"Get Portfolio Performance","description":"지정한 포트폴리오의 성과 지표를 반환합니다.","operationId":"get_portfolio_performance_api_v1_portfolio__portfolio_id__performance_get","parameters":[{"name":"portfolio_id","in":"path","required":true,"schema":{"type":"string","title":"Portfolio Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/portfolio/{portfolio_id}/rebalance":{"post":{"tags":["portfolio"],"summary":"Rebalance Portfolio","description":"포트폴리오 리밸런싱 제안과 예상 지표를 생성합니다.","operationId":"rebalance_portfolio_api_v1_portfolio__portfolio_id__rebalance_post","parameters":[{"name":"portfolio_id","in":"path","required":true,"schema":{"type":"string","title":"Portfolio Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/stocks/search":{"get":{"tags":["stocks"],"summary":"Search Stocks","description":"종목명 또는 종목코드로 주식을 검색합니다.","operationId":"search_stocks_api_v1_stocks_search_get","parameters":[{"name":"q","in":"query","required":true,"schema":{"type":"string","minLength":1,"title":"Q"}},{"name":"market","in":"query","required":false,"schema":{"type":"string","default":"KOSPI","title":"Market"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/stocks/{stock_code}":{"get":{"tags":["stocks"],"summary":"Get Stock Info","description":"특정 종목의 기본 정보를 조회합니다.","operationId":"get_stock_info_api_v1_stocks__stock_code__get","parameters":[{"name":"stock_code","in":"path","required":true,"schema":{"type":"string","title":"Stock Code"}},{"name":"market","in":"query","required":false,"schema":{"type":"string","default":"KOSPI","title":"Market"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StockInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/stocks/{stock_code}/price-history":{"get":{"tags":["stocks"],"summary":"Get Price History","description":"특정 종목의 기간별 주가 히스토리를 반환합니다.","operationId":"get_price_history_api_v1_stocks__stock_code__price_history_get","parameters":[{"name":"stock_code","in":"path","required":true,"schema":{"type":"string","title":"Stock Code"}},{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"default":30,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/stocks/{stock_code}/analysis":{"get":{"tags":["stocks"],"summary":"Get Stock Analysis","description":"리서치 에이전트를 호출해 종합 종목 분석을 제공합니다.","operationId":"get_stock_analysis_api_v1_stocks__stock_code__analysis_get","parameters":[{"name":"stock_code","in":"path","required":true,"schema":{"type":"string","title":"Stock Code"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"summary":"Root","description":"애플리케이션 기본 상태를 확인하는 엔드포인트입니다.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"summary":"Health","description":"데이터베이스 연결 여부 등 상세 상태를 확인하는 엔드포인트입니다.","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AccountConnection":{"properties":{"broker":{"type":"string","title":"Broker"},"account_number":{"type":"string","title":"Account Number"},"status":{"type":"string","title":"Status"},"last_synced_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Synced At"}},"type":"object","required":["broker","account_number","status"],"title":"AccountConnection","description":"증권 계좌 연결 상태 정보"},"ActivityItem":{"properties":{"id":{"type":"string","title":"Id"},"type":{"type":"string","title":"Type"},"icon":{"type":"string","title":"Icon"},"title":{"type":"string","title":"Title"},"description":{"type":"string","title":"Description"},"timestamp":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Timestamp"},"status":{"type":"string","title":"Status"},"amount":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Amount"}},"type":"object","required":["id","type","icon","title","description","status"],"title":"ActivityItem","description":"최근 활동 이력"},"AllocationItem":{"properties":{"name":{"type":"string","title":"Name"},"value":{"type":"number","title":"Value"},"percentage":{"type":"number","title":"Percentage"}},"type":"object","required":["name","value","percentage"],"title":"AllocationItem","description":"배분 정보 항목"},"ApprovalRequest":{"properties":{"thread_id":{"type":"string","title":"Thread Id","description":"대화 스레드 ID"},"decision":{"type":"string","title":"Decision","description":"승인 결정: approved, rejected, modified"},"automation_level":{"type":"integer","maximum":3.0,"minimum":1.0,"title":"Automation Level","default":2},"modifications":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Modifications"},"user_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Notes"}},"type":"object","required":["thread_id","decision"],"title":"ApprovalRequest","description":"승인 요청 스키마"},"ApprovalResponse":{"properties":{"status":{"type":"string","title":"Status"},"message":{"type":"string","title":"Message"},"conversation_id":{"type":"string","title":"Conversation Id"},"result":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Result"}},"type":"object","required":["status","message","conversation_id"],"title":"ApprovalResponse","description":"승인 응답 스키마"},"AutomationSettings":{"properties":{"level":{"type":"integer","title":"Level"},"level_name":{"type":"string","title":"Level Name"},"enabled":{"type":"boolean","title":"Enabled"}},"type":"object","required":["level","level_name","enabled"],"title":"AutomationSettings","description":"자동화 설정 정보"},"ChatRequest":{"properties":{"message":{"type":"string","title":"Message"},"conversation_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Conversation Id"},"automation_level":{"type":"integer","maximum":3.0,"minimum":1.0,"title":"Automation Level","description":"자동화 레벨: 1=Pilot, 2=Copilot, 3=Advisor","default":2}},"type":"object","required":["message"],"title":"ChatRequest","description":"채팅 요청 스키마"},"ChatResponse":{"properties":{"message":{"type":"string","title":"Message"},"conversation_id":{"type":"string","title":"Conversation Id"},"requires_approval":{"type":"boolean","title":"Requires Approval","default":false},"approval_request":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Approval Request"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["message","conversation_id"],"title":"ChatResponse","description":"채팅 응답 스키마"},"ChatSessionSummary":{"properties":{"conversation_id":{"type":"string","title":"Conversation Id"},"title":{"type":"string","title":"Title"},"last_message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Message"},"last_message_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Message At"},"automation_level":{"type":"integer","title":"Automation Level"},"message_count":{"type":"integer","title":"Message Count"},"created_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["conversation_id","title","automation_level","message_count"],"title":"ChatSessionSummary","description":"채팅 세션 요약 스키마"},"DashboardPayload":{"properties":{"total_assets":{"$ref":"#/components/schemas/TotalAssets"},"account_connection":{"$ref":"#/components/schemas/AccountConnection"},"automation_settings":{"$ref":"#/components/schemas/AutomationSettings"},"recent_activities":{"items":{"$ref":"#/components/schemas/ActivityItem"},"type":"array","title":"Recent Activities"},"top_holdings":{"items":{"$ref":"#/components/schemas/HoldingHighlight"},"type":"array","title":"Top Holdings"},"performance_summary":{"$ref":"#/components/schemas/PerformanceSummary"}},"type":"object","required":["total_assets","account_connection","automation_settings","recent_activities","top_holdings","performance_summary"],"title":"DashboardPayload","description":"대시보드 API 응답 페이로드"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HoldingHighlight":{"properties":{"stock_code":{"type":"string","title":"Stock Code"},"stock_name":{"type":"string","title":"Stock Name"},"quantity":{"type":"integer","title":"Quantity"},"value":{"type":"number","title":"Value"},"profit_rate":{"type":"number","title":"Profit Rate"},"weight":{"type":"number","title":"Weight"}},"type":"object","required":["stock_code","stock_name","quantity","value","profit_rate","weight"],"title":"HoldingHighlight","description":"상위 보유 종목 요약"},"PerformancePeriod":{"properties":{"profit":{"type":"number","title":"Profit"},"profit_rate":{"type":"number","title":"Profit Rate"}},"type":"object","required":["profit","profit_rate"],"title":"PerformancePeriod","description":"기간별 성과 지표"},"PerformanceSummary":{"properties":{"today":{"$ref":"#/components/schemas/PerformancePeriod"},"week":{"$ref":"#/components/schemas/PerformancePeriod"},"month":{"$ref":"#/components/schemas/PerformancePeriod"},"year":{"$ref":"#/components/schemas/PerformancePeriod"}},"type":"object","required":["today","week","month","year"],"title":"PerformanceSummary","description":"기간별 성과 요약"},"PortfolioAllocation":{"properties":{"sectors":{"items":{"$ref":"#/components/schemas/AllocationItem"},"type":"array","title":"Sectors"},"asset_classes":{"items":{"$ref":"#/components/schemas/AllocationItem"},"type":"array","title":"Asset Classes"}},"type":"object","required":["sectors","asset_classes"],"title":"PortfolioAllocation","description":"자산 및 섹터 배분 정보"},"PortfolioHoldingItem":{"properties":{"stock_code":{"type":"string","title":"Stock Code"},"stock_name":{"type":"string","title":"Stock Name"},"quantity":{"type":"integer","title":"Quantity"},"avg_price":{"type":"number","title":"Avg Price"},"current_price":{"type":"number","title":"Current Price"},"market_value":{"type":"number","title":"Market Value"},"profit":{"type":"number","title":"Profit"},"profit_rate":{"type":"number","title":"Profit Rate"},"weight":{"type":"number","title":"Weight"}},"type":"object","required":["stock_code","stock_name","quantity","avg_price","current_price","market_value","profit","profit_rate","weight"],"title":"PortfolioHoldingItem","description":"보유 종목 세부 정보"},"PortfolioOverview":{"properties":{"summary":{"$ref":"#/components/schemas/PortfolioSummarySection"},"holdings":{"items":{"$ref":"#/components/schemas/PortfolioHoldingItem"},"type":"array","title":"Holdings"},"allocation":{"$ref":"#/components/schemas/PortfolioAllocation"}},"type":"object","required":["summary","holdings","allocation"],"title":"PortfolioOverview","description":"포트폴리오 오버뷰 응답 페이로드"},"PortfolioSummary":{"properties":{"portfolio_id":{"type":"string","title":"Portfolio Id"},"total_value":{"type":"string","title":"Total Value"},"cash_balance":{"type":"string","title":"Cash Balance"},"invested_amount":{"type":"string","title":"Invested Amount"},"total_return":{"type":"string","title":"Total Return"},"positions":{"items":{"$ref":"#/components/schemas/Position"},"type":"array","title":"Positions"},"risk_profile":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Risk Profile"},"last_updated":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Updated"}},"type":"object","required":["portfolio_id","total_value","cash_balance","invested_amount","total_return","positions"],"title":"PortfolioSummary","description":"포트폴리오 요약"},"PortfolioSummarySection":{"properties":{"total_value":{"type":"number","title":"Total Value"},"principal":{"type":"number","title":"Principal"},"profit":{"type":"number","title":"Profit"},"profit_rate":{"type":"number","title":"Profit Rate"},"cash":{"type":"number","title":"Cash"},"cash_percentage":{"type":"number","title":"Cash Percentage"},"updated_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["total_value","principal","profit","profit_rate","cash","cash_percentage"],"title":"PortfolioSummarySection","description":"포트폴리오 전체 요약 정보"},"Position":{"properties":{"stock_code":{"type":"string","title":"Stock Code"},"stock_name":{"type":"string","title":"Stock Name"},"quantity":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Quantity"},"average_price":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Average Price"},"current_price":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Current Price"},"market_value":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Market Value"},"unrealized_pnl":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unrealized Pnl"},"unrealized_pnl_rate":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unrealized Pnl Rate"},"weight":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Weight"},"sector":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Sector"}},"type":"object","required":["stock_code","stock_name"],"title":"Position","description":"포트폴리오 보유 종목"},"StockInfo":{"properties":{"stock_code":{"type":"string","title":"Stock Code"},"stock_name":{"type":"string","title":"Stock Name"},"market":{"type":"string","title":"Market"},"sector":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Sector"},"current_price":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Current Price"},"change_rate":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Change Rate"},"volume":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Volume"}},"type":"object","required":["stock_code","stock_name","market","sector","current_price","change_rate","volume"],"title":"StockInfo","description":"주식 기본 정보"},"TotalAssets":{"properties":{"value":{"type":"number","title":"Value"},"profit":{"type":"number","title":"Profit"},"profit_rate":{"type":"number","title":"Profit Rate"},"change_24h":{"type":"number","title":"Change 24H"},"change_24h_rate":{"type":"number","title":"Change 24H Rate"}},"type":"object","required":["value","profit","profit_rate","change_24h","change_24h_rate"],"title":"TotalAssets","description":"총자산 요약 정보"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}},"tags":[{"name":"chat","description":"대화 생성, 히스토리 조회, 승인 처리를 담당하는 엔드포인트 모음입니다."},{"name":"dashboard","description":"대시보드 화면에 필요한 자산 요약, 활동 로그 등을 제공합니다."},{"name":"portfolio","description":"포트폴리오 요약과 리밸런싱 등 자산 관리 기능을 위한 엔드포인트입니다."},{"name":"stocks","description":"종목 검색 및 시세 조회와 같은 주식 데이터 관련 API입니다."}]}